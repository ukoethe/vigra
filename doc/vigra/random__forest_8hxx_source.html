<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><TITLE>vigra - vigra/random_forest.hxx Source File</TITLE>
<link rel=stylesheet type="text/css" href="vigra.css">
<link rel=stylesheet type="text/css" href="vigra_1_8_2.css">
<link rel="shortcut icon" href="vigra-icon.ico" />
<script type="text/javascript">
function toggleHiddenDocumentation( textID, toggleID, toggleMessage )
{ 
	if( document.getElementById(textID).style.display == 'none' )
    {
		document.getElementById(textID).style.display = 'block';
        document.getElementById(toggleID).innerHTML = "hide " + toggleMessage;
    }
    else
    {
		document.getElementById(textID).style.display = 'none';
        document.getElementById(toggleID).innerHTML = "show " + toggleMessage;
	}
    return false;
}
</script>
</head>
<body  bgcolor="#f8f0e0" link="#0040b0" vlink="#a00040">
<basefont face="Helvetica,Arial,sans-serif" size=3>
<p align=right>
[ <a href="http://hci.iwr.uni-heidelberg.de/vigra/">VIGRA Homepage</a> |
 <a href="functionindex.html">Function Index</a> |
 <a href="classes.html">Class Index</a> |
 <a href="namespaces.html">Namespaces</a> |
 <a href="files.html">File List</a> |
 <a href="index.html">Main Page</a> ]
</p>
<!-- Generated by Doxygen 1.8.3.1 -->
</div><!-- top -->
<div class="contents">
<table class="main_heading">
<tr>
<td width="100%">random_forest.hxx
</td>
<td align=right><a href="http://hci.iwr.uni-heidelberg.de/vigra/"><IMG border=0 ALT="VIGRA" SRC="documents/vigra.gif" title="VIGRA Homepage"></a></td></tr>
</table><p>

<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/************************************************************************/</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">/*        Copyright 2008-2009 by  Ullrich Koethe and Rahul Nair         */</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">/*    This file is part of the VIGRA computer vision library.           */</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">/*    The VIGRA Website is                                              */</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">/*        http://hci.iwr.uni-heidelberg.de/vigra/                       */</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">/*    Please direct questions, bug reports, and contributions to        */</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/*        ullrich.koethe@iwr.uni-heidelberg.de    or                    */</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">/*        vigra@informatik.uni-hamburg.de                               */</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/*    Permission is hereby granted, free of charge, to any person       */</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">/*    obtaining a copy of this software and associated documentation    */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/*    files (the &quot;Software&quot;), to deal in the Software without           */</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/*    restriction, including without limitation the rights to use,      */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/*    copy, modify, merge, publish, distribute, sublicense, and/or      */</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">/*    sell copies of the Software, and to permit persons to whom the    */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">/*    Software is furnished to do so, subject to the following          */</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*    conditions:                                                       */</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/*    The above copyright notice and this permission notice shall be    */</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/*    included in all copies or substantial portions of the             */</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">/*    Software.                                                         */</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">/*    THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND    */</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">/*    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES   */</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/*    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND          */</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">/*    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT       */</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">/*    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,      */</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">/*    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING      */</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">/*    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR     */</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">/*    OTHER DEALINGS IN THE SOFTWARE.                                   */</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/************************************************************************/</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#ifndef VIGRA_RANDOM_FOREST_HXX</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VIGRA_RANDOM_FOREST_HXX</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &lt;numeric&gt;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;mathutil.hxx&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;array_vector.hxx&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;sized_int.hxx&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;matrix.hxx&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;random.hxx&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;functorexpression.hxx&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;random_forest/rf_common.hxx&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;random_forest/rf_nodeproxy.hxx&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;random_forest/rf_split.hxx&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;random_forest/rf_decisionTree.hxx&quot;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;random_forest/rf_visitors.hxx&quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;random_forest/rf_region.hxx&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;sampling.hxx&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;random_forest/rf_preprocessing.hxx&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;random_forest/rf_online_prediction_set.hxx&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;random_forest/rf_earlystopping.hxx&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;random_forest/rf_ridge_split.hxx&quot;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="keyword">namespace </span>vigra</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;{</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">/** \addtogroup MachineLearning Machine Learning</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">    This module provides classification algorithms that map </span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">    features to labels or label probabilities.</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">    Look at the RandomForest class first for a overview of most of the </span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">    functionality provided as well as use cases. </span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">**/</span><span class="comment"></span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">//@{</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keyword">namespace </span>detail</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;{</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">/* \brief sampling option factory function</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keyword">inline</span> SamplerOptions make_sampler_opt ( RandomForestOptions     &amp; RF_opt)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;{</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    SamplerOptions return_opt;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    return_opt.<a class="code" href="classvigra_1_1SamplerOptions.html#a71724571dc7a52e5be40aefb51230397" title="Sample from training population with replacement.">withReplacement</a>(RF_opt.sample_with_replacement_);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    return_opt.<a class="code" href="classvigra_1_1SamplerOptions.html#a849f4fbf15f9555862fd54dc2ffd178c" title="Draw equally many samples from each &quot;stratum&quot;. A stratum is a group of like entities, e.g. pixels belonging to the same object class. This is useful to create balanced samples when the class probabilities are very unbalanced (e.g. when there are many background and few foreground pixels). Stratified sampling thus avoids that a trained classifier is biased towards the majority class.">stratified</a>(RF_opt.stratification_method_ == RF_EQUAL);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">return</span> return_opt;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;}<span class="comment">//namespace detail</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">/** Random Forest class</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"> * \tparam &lt;LabelType = double&gt; Type used for predicted labels.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"> * \tparam &lt;PreprocessorTag = ClassificationTag&gt; Class used to preprocess</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> *          the input while learning and predicting. Currently Available:</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"> *          ClassificationTag and RegressionTag. It is recommended to use</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"> *          Splitfunctor::Preprocessor_t while using custom splitfunctors</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"> *          as they may need the data to be in a different format. </span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"> *          \sa Preprocessor</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"> *  </span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"> *  Simple usage for classification (regression is not yet supported):</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"> *  look at RandomForest::learn() as well as RandomForestOptions() for additional</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"> *  options. </span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"> *  \code</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"> *  using namespace vigra;</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"> *  using namespace rf;</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> *  typedef xxx feature_t; \\ replace xxx with whichever type</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> *  typedef yyy label_t;   \\ likewise </span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> *  </span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"> *  // allocate the training data</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"> *  MultiArrayView&lt;2, feature_t&gt; f = get_training_features();</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"> *  MultiArrayView&lt;2, label_t&gt;   l = get_training_labels();</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"> *  </span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"> *  RandomForest&lt;label_t&gt; rf;</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"> *  // construct visitor to calculate out-of-bag error</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"> *  visitors::OOB_Error oob_v;</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"> *  // perform training</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"> *  rf.learn(f, l, visitors::create_visitor(oob_v));</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment"> *  std::cout &lt;&lt; &quot;the out-of-bag error is: &quot; &lt;&lt; oob_v.oob_breiman &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"> *      </span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"> *  // get features for new data to be used for prediction</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"> *  MultiArrayView&lt;2, feature_t&gt; pf = get_features();</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"> *  // allocate space for the response (pf.shape(0) is the number of samples)</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"> *  MultiArrayView&lt;2, label_t&gt; prediction(pf.shape(0), 1);</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"> *  MultiArrayView&lt;2, double&gt; prob(pf.shape(0), rf.class_count());</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"> *      </span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"> *  // perform prediction on new data</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"> *  rf.predictLabels(pf, prediction);</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"> *  rf.predictProbabilities(pf, prob);</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"> *  \endcode</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"> *  Additional information such as Variable Importance measures are accessed</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> *  via Visitors defined in rf::visitors. </span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"> *  Have a look at rf::split for other splitting methods.</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> LabelType = <span class="keywordtype">double</span> , <span class="keyword">class</span> PreprocessorTag = ClassificationTag &gt;</div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html">  144</a></span>&#160;<span class="keyword">class </span><a class="code" href="classvigra_1_1RandomForest.html">RandomForest</a></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;{</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">//public typedefs</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1RandomForestOptions.html" title="Options object for the random forest.">RandomForestOptions</a>             <a class="code" href="classvigra_1_1RandomForestOptions.html" title="Options object for the random forest.">Options_t</a>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keyword">typedef</span> detail::DecisionTree            DecisionTree_t;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1ProblemSpec.html" title="problem specification class for the random forest.">ProblemSpec&lt;LabelType&gt;</a>          <a class="code" href="classvigra_1_1ProblemSpec.html" title="problem specification class for the random forest.">ProblemSpec_t</a>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1ThresholdSplit.html">GiniSplit</a>                       <a class="code" href="classvigra_1_1ThresholdSplit.html">Default_Split_t</a>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1EarlyStoppStd.html" title="Standard early stopping criterion.">EarlyStoppStd</a>                   <a class="code" href="classvigra_1_1EarlyStoppStd.html" title="Standard early stopping criterion.">Default_Stop_t</a>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1rf_1_1visitors_1_1StopVisiting.html">rf::visitors::StopVisiting</a>      <a class="code" href="classvigra_1_1rf_1_1visitors_1_1StopVisiting.html">Default_Visitor_t</a>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keyword">typedef</span>  <a class="code" href="classvigra_1_1DT__StackEntry.html">DT_StackEntry&lt;ArrayVectorView&lt;Int32&gt;::iterator</a>&gt;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                    <a class="code" href="classvigra_1_1DT__StackEntry.html">StackEntry_t</a>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keyword">typedef</span> LabelType                       LabelT; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">//problem independent data.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="classvigra_1_1RandomForestOptions.html" title="Options object for the random forest.">Options_t</a>                                   options_;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">//problem dependent data members - is only set if</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">//a copy constructor, some sort of import</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">//function or the learn function is called</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <a class="code" href="classvigra_1_1ArrayVector.html">ArrayVector&lt;DecisionTree_t&gt;</a>                 trees_;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="classvigra_1_1ProblemSpec.html" title="problem specification class for the random forest.">ProblemSpec_t</a>                               ext_param_;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">/*mutable ArrayVector&lt;int&gt;                    tree_indices_;*/</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <a class="code" href="classvigra_1_1rf_1_1visitors_1_1OnlineLearnVisitor.html">rf::visitors::OnlineLearnVisitor</a>            online_visitor_;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordtype">void</span> reset()</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        ext_param_.clear();</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        trees_.clear();</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">    /** \name Constructors</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">     * Note: No copy Constructor specified as no pointers are manipulated</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">     * in this class</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">/*\{*/</span><span class="comment"></span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">    /**\brief default constructor</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">     * \param options   general options to the Random Forest. Must be of Type</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">     *                  Options_t</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">     * \param ext_param problem specific values that can be supplied </span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">     *                  additionally. (class weights , labels etc)</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">     * \sa  RandomForestOptions, ProblemSpec</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#a333e71f47b2197ab6b6db18d50e7fc3a">  192</a></span>&#160;    <a class="code" href="classvigra_1_1RandomForest.html#a333e71f47b2197ab6b6db18d50e7fc3a" title="default constructor">RandomForest</a>(<a class="code" href="classvigra_1_1RandomForestOptions.html" title="Options object for the random forest.">Options_t</a> <span class="keyword">const</span> &amp; <a class="code" href="classvigra_1_1RandomForest.html#a8eae2156ea49cc300405359243b44e23" title="access const random forest options">options</a> = <a class="code" href="classvigra_1_1RandomForestOptions.html" title="Options object for the random forest.">Options_t</a>(), </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                 <a class="code" href="classvigra_1_1ProblemSpec.html" title="problem specification class for the random forest.">ProblemSpec_t</a> <span class="keyword">const</span> &amp; <a class="code" href="classvigra_1_1RandomForest.html#a8be3a3faa1f6c460f44a5a39439e2534" title="return external parameters for viewing">ext_param</a> = <a class="code" href="classvigra_1_1ProblemSpec.html" title="problem specification class for the random forest.">ProblemSpec_t</a>())</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    :</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        options_(<a class="code" href="classvigra_1_1RandomForest.html#a8eae2156ea49cc300405359243b44e23" title="access const random forest options">options</a>),</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        ext_param_(<a class="code" href="classvigra_1_1RandomForest.html#a8be3a3faa1f6c460f44a5a39439e2534" title="return external parameters for viewing">ext_param</a>)<span class="comment">/*,</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">        tree_indices_(options.tree_count_,0)*/</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="comment">/*for(int ii = 0 ; ii &lt; int(tree_indices_.size()); ++ii)</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">            tree_indices_[ii] = ii;*/</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">    /**\brief Create RF from external source</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">     * \param treeCount Number of trees to add.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">     * \param topology_begin     </span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">     *                  Iterator to a Container where the topology_ data</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">     *                  of the trees are stored.</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">     *                  Iterator should support at least treeCount forward </span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">     *                  iterations. (i.e. topology_end - topology_begin &gt;= treeCount</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">     * \param parameter_begin  </span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">     *                  iterator to a Container where the parameters_ data</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">     *                  of the trees are stored. Iterator should support at </span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">     *                  least treeCount forward iterations.</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">     * \param problem_spec </span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">     *                  Extrinsic parameters that specify the problem e.g.</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">     *                  ClassCount, featureCount etc.</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">     * \param options   (optional) specify options used to train the original</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">     *                  Random forest. This parameter is not used anywhere</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">     *                  during prediction and thus is optional.</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;     <span class="comment">/* TODO: This constructor may be replaced by a Constructor using</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">     * NodeProxy iterators to encapsulate the underlying data type.</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keyword">template</span>&lt;<span class="keyword">class</span> TopologyIterator, <span class="keyword">class</span> ParameterIterator&gt;</div>
<div class="line"><a name="l00226"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#a04b9a3f032fdb72129dc22bc1781860b">  226</a></span>&#160;    <a class="code" href="classvigra_1_1RandomForest.html#a333e71f47b2197ab6b6db18d50e7fc3a" title="default constructor">RandomForest</a>(<span class="keywordtype">int</span>                       treeCount,</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                  TopologyIterator         topology_begin,</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                  ParameterIterator        parameter_begin,</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                  <a class="code" href="classvigra_1_1ProblemSpec.html" title="problem specification class for the random forest.">ProblemSpec_t</a> <span class="keyword">const</span> &amp; problem_spec,</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                  <a class="code" href="classvigra_1_1RandomForestOptions.html" title="Options object for the random forest.">Options_t</a> <span class="keyword">const</span> &amp;     <a class="code" href="classvigra_1_1RandomForest.html#a8eae2156ea49cc300405359243b44e23" title="access const random forest options">options</a> = <a class="code" href="classvigra_1_1RandomForestOptions.html" title="Options object for the random forest.">Options_t</a>())</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    :</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        trees_(treeCount, DecisionTree_t(problem_spec)),</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        ext_param_(problem_spec),</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        options_(<a class="code" href="classvigra_1_1RandomForest.html#a8eae2156ea49cc300405359243b44e23" title="access const random forest options">options</a>)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;treeCount; ++k, ++topology_begin, ++parameter_begin)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            trees_[k].topology_ = *topology_begin;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            trees_[k].parameters_ = *parameter_begin;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">/*\}*/</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">    /** \name Data Access</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">     * data access interface - usage of member variables is deprecated</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">/*\{*/</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">    /**\brief return external parameters for viewing</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">     * \return ProblemSpec_t</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00256"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#a8be3a3faa1f6c460f44a5a39439e2534">  256</a></span>&#160;    <a class="code" href="classvigra_1_1ProblemSpec.html" title="problem specification class for the random forest.">ProblemSpec_t</a> <span class="keyword">const</span> &amp; <a class="code" href="classvigra_1_1RandomForest.html#a8be3a3faa1f6c460f44a5a39439e2534" title="return external parameters for viewing">ext_param</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        vigra_precondition(ext_param_.used() == <span class="keyword">true</span>,</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;           <span class="stringliteral">&quot;RandomForest::ext_param(): &quot;</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;           <span class="stringliteral">&quot;Random forest has not been trained yet.&quot;</span>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">return</span> ext_param_;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">    /**\brief set external parameters</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">     *  \param in external parameters to be set</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">     * set external parameters explicitly. </span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">     * If Random Forest has not been trained the preprocessor will </span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">     * either ignore filling values set this way or will throw an exception </span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">     * if values specified manually do not match the value calculated </span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">     &amp; during the preparation step.</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#a278cd4498ffaa9e513b5c4248fff68be">  274</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classvigra_1_1RandomForest.html#a278cd4498ffaa9e513b5c4248fff68be" title="set external parameters">set_ext_param</a>(<a class="code" href="classvigra_1_1ProblemSpec.html" title="problem specification class for the random forest.">ProblemSpec_t</a> <span class="keyword">const</span> &amp; in)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        vigra_precondition(ext_param_.used() == <span class="keyword">false</span>,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="stringliteral">&quot;RandomForest::set_ext_param():&quot;</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="stringliteral">&quot;Random forest has been trained! Call reset()&quot;</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="stringliteral">&quot;before specifying new extrinsic parameters.&quot;</span>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">    /**\brief access random forest options</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">     * \return random forest options</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00286"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#acf93289f0400da36167d02532ee786f4">  286</a></span>&#160;    <a class="code" href="classvigra_1_1RandomForestOptions.html" title="Options object for the random forest.">Options_t</a> &amp; <a class="code" href="classvigra_1_1RandomForest.html#acf93289f0400da36167d02532ee786f4" title="access random forest options">set_options</a>()</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classvigra_1_1RandomForest.html#a8eae2156ea49cc300405359243b44e23" title="access const random forest options">options</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">    /**\brief access const random forest options</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">     * \return const Option_t</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00296"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#a8eae2156ea49cc300405359243b44e23">  296</a></span>&#160;    <a class="code" href="classvigra_1_1RandomForestOptions.html" title="Options object for the random forest.">Options_t</a> <span class="keyword">const</span> &amp; <a class="code" href="classvigra_1_1RandomForest.html#a8eae2156ea49cc300405359243b44e23" title="access const random forest options">options</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordflow">return</span> options_;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">    /**\brief access const trees</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00303"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#a2782c3291acfa66c8f306288fc8e7196">  303</a></span>&#160;    DecisionTree_t <span class="keyword">const</span> &amp; <a class="code" href="classvigra_1_1RandomForest.html#a2782c3291acfa66c8f306288fc8e7196" title="access const trees">tree</a>(<span class="keywordtype">int</span> index)<span class="keyword"> const</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">return</span> trees_[index];</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">    /**\brief access trees</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00310"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#aad23f94673a4f0a72328a1a4c16adfee">  310</a></span>&#160;    DecisionTree_t &amp; <a class="code" href="classvigra_1_1RandomForest.html#a2782c3291acfa66c8f306288fc8e7196" title="access const trees">tree</a>(<span class="keywordtype">int</span> index)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">return</span> trees_[index];</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">/*\}*/</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">    /**\brief return number of features used while </span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">     * training.</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00320"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#a9bd0ac979ee86f839b3c4574e6f95f58">  320</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classvigra_1_1RandomForest.html#a9bd0ac979ee86f839b3c4574e6f95f58" title="return number of features used while training.">feature_count</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">return</span> ext_param_.column_count_;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment"></span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">    /**\brief return number of features used while </span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">     * training.</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">     * deprecated. Use feature_count() instead.</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00331"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#acd888c75c503a4f3d2ede13bf1d714c2">  331</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classvigra_1_1RandomForest.html#acd888c75c503a4f3d2ede13bf1d714c2" title="return number of features used while training.">column_count</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordflow">return</span> ext_param_.column_count_;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">    /**\brief return number of classes used while </span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">     * training.</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00339"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#aa923211d8be473d9ea70329ed9e2e72d">  339</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classvigra_1_1RandomForest.html#aa923211d8be473d9ea70329ed9e2e72d" title="return number of classes used while training.">class_count</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="keywordflow">return</span> ext_param_.class_count_;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">    /**\brief return number of trees</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00346"></a><span class="lineno"><a class="code" href="classvigra_1_1RandomForest.html#a230d05321ffe94cb138c13bd4ed71e76">  346</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classvigra_1_1RandomForest.html#a230d05321ffe94cb138c13bd4ed71e76" title="return number of trees">tree_count</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordflow">return</span> options_.tree_count_;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keyword">template</span>&lt;<span class="keyword">class </span>U,<span class="keyword">class </span>C1,</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keyword">class </span>U2, <span class="keyword">class </span>C2,</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keyword">class </span>Split_t,</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keyword">class </span>Stop_t,</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keyword">class </span>Visitor_t,</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keyword">class </span>Random_t&gt;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordtype">void</span> onlineLearn(   <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2,U,C1&gt;</a> <span class="keyword">const</span> &amp; features,</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                        <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2,U2,C2&gt;</a> <span class="keyword">const</span> &amp; response,</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                        <span class="keywordtype">int</span> new_start_index,</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                        Visitor_t visitor_,</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                        Split_t split_,</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                        Stop_t stop_,</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                        Random_t &amp; random,</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                        <span class="keywordtype">bool</span> adjust_thresholds=<span class="keyword">false</span>);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> U2,<span class="keyword">class</span> C2&gt;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordtype">void</span> onlineLearn(   <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C1&gt;</a> <span class="keyword">const</span>  &amp; features,</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                        <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U2,C2&gt;</a> <span class="keyword">const</span>  &amp; labels,<span class="keywordtype">int</span> new_start_index,<span class="keywordtype">bool</span> adjust_thresholds=<span class="keyword">false</span>)</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <a class="code" href="classvigra_1_1RandomNumberGenerator.html">RandomNumberGenerator&lt;&gt;</a> rnd = <a class="code" href="classvigra_1_1RandomNumberGenerator.html">RandomNumberGenerator&lt;&gt;</a>(RandomSeed);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        onlineLearn(features, </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    labels, </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    new_start_index,</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                    <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>(), </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>(), </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                    <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>(),</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                    rnd,</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                    adjust_thresholds);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keyword">template</span>&lt;<span class="keyword">class </span>U,<span class="keyword">class </span>C1,</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keyword">class </span>U2, <span class="keyword">class </span>C2,</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keyword">class </span>Split_t,</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keyword">class </span>Stop_t,</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="keyword">class </span>Visitor_t,</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keyword">class </span>Random_t&gt;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#gae1ccc1e1d0b2d4aaec94005e775b4db2">reLearnTree</a>(MultiArrayView&lt;2,U,C1&gt; <span class="keyword">const</span> &amp; features,</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                     MultiArrayView&lt;2,U2,C2&gt; <span class="keyword">const</span> &amp; response,</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                     <span class="keywordtype">int</span> treeId,</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                     Visitor_t visitor_,</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                     Split_t split_,</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                     Stop_t stop_,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                     Random_t &amp; random);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keyword">template</span>&lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> U2, <span class="keyword">class</span> C2&gt;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#gae1ccc1e1d0b2d4aaec94005e775b4db2">reLearnTree</a>(MultiArrayView&lt;2, U, C1&gt; <span class="keyword">const</span> &amp; features,</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                     MultiArrayView&lt;2, U2, C2&gt; <span class="keyword">const</span> &amp; labels,</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                     <span class="keywordtype">int</span> treeId)</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        RandomNumberGenerator&lt;&gt; rnd = RandomNumberGenerator&lt;&gt;(RandomSeed);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <a class="code" href="group__MachineLearning.html#gae1ccc1e1d0b2d4aaec94005e775b4db2">reLearnTree</a>(features,</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    labels,</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                    treeId,</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                    <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>(),</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                    <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>(),</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                    <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>(),</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                    rnd);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">    /**\name Learning</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">     * Following functions differ in the degree of customization</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">     * allowed</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="comment">/*\{*/</span><span class="comment"></span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">    /**\brief learn on data with custom config and random number generator</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">     * \param features  a N x M matrix containing N samples with M</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">     *                  features</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">     * \param response  a N x D matrix containing the corresponding</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">     *                  response. Current split functors assume D to</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">     *                  be 1 and ignore any additional columns.</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">     *                  This is not enforced to allow future support</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">     *                  for uncertain labels, label independent strata etc.</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">     *                  The Preprocessor specified during construction</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">     *                  should be able to handle features and labels</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">     *                  features and the labels.</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">     *                  see also: SplitFunctor, Preprocessing</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">     * \param visitor   visitor which is to be applied after each split,</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">     *                  tree and at the end. Use rf_default() for using</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">     *                  default value. (No Visitors)</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">     *                  see also: rf::visitors</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">     * \param split     split functor to be used to calculate each split</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">     *                  use rf_default() for using default value. (GiniSplit)</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">     *                  see also:  rf::split </span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">     * \param stop</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">     *                  predicate to be used to calculate each split</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">     *                  use rf_default() for using default value. (EarlyStoppStd)</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">     * \param random    RandomNumberGenerator to be used. Use</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">     *                  rf_default() to use default value.(RandomMT19337)</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class </span>U, <span class="keyword">class </span>C1,</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;             <span class="keyword">class </span>U2,<span class="keyword">class </span>C2,</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;             <span class="keyword">class </span>Split_t,</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;             <span class="keyword">class </span>Stop_t,</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;             <span class="keyword">class </span>Visitor_t,</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;             <span class="keyword">class </span>Random_t&gt;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05" title="learn on data with custom config and random number generator">learn</a>( MultiArrayView&lt;2, U, C1&gt; <span class="keyword">const</span>  &amp;   features,</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                MultiArrayView&lt;2, U2,C2&gt; <span class="keyword">const</span>  &amp;   response,</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                Visitor_t                           visitor,</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                Split_t                             split,</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                Stop_t                              stop,</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                Random_t                 <span class="keyword">const</span>  &amp;   random);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class </span>U, <span class="keyword">class </span>C1,</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;             <span class="keyword">class </span>U2,<span class="keyword">class </span>C2,</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;             <span class="keyword">class </span>Split_t,</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;             <span class="keyword">class </span>Stop_t,</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;             <span class="keyword">class </span>Visitor_t&gt;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05" title="learn on data with custom config and random number generator">learn</a>( MultiArrayView&lt;2, U, C1&gt; <span class="keyword">const</span>  &amp;   features,</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                MultiArrayView&lt;2, U2,C2&gt; <span class="keyword">const</span>  &amp;   response,</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                Visitor_t                           visitor,</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                Split_t                             split,</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                Stop_t                              stop)</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        RandomNumberGenerator&lt;&gt; rnd = RandomNumberGenerator&lt;&gt;(RandomSeed);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05" title="learn on data with custom config and random number generator">learn</a>(  features, </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                response,</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                visitor, </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                split, </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                stop,</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                rnd);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> U2,<span class="keyword">class</span> C2, <span class="keyword">class</span> Visitor_t&gt;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05" title="learn on data with custom config and random number generator">learn</a>( MultiArrayView&lt;2, U, C1&gt; <span class="keyword">const</span>  &amp; features,</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                MultiArrayView&lt;2, U2,C2&gt; <span class="keyword">const</span>  &amp; labels,</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                Visitor_t                         visitor)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    {</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05" title="learn on data with custom config and random number generator">learn</a>(  features, </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                labels, </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                visitor, </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>(), </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>());</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class </span>U, <span class="keyword">class </span>C1, <span class="keyword">class </span>U2,<span class="keyword">class </span>C2, </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;              <span class="keyword">class </span>Visitor_t, <span class="keyword">class </span>Split_t&gt;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05" title="learn on data with custom config and random number generator">learn</a>(   MultiArrayView&lt;2, U, C1&gt; <span class="keyword">const</span>  &amp; features,</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                  MultiArrayView&lt;2, U2,C2&gt; <span class="keyword">const</span>  &amp; labels,</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                  Visitor_t                         visitor,</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                  Split_t                           split)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05" title="learn on data with custom config and random number generator">learn</a>(  features, </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                labels, </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                visitor, </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                split, </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>());</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">    /**\brief learn on data with default configuration</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">     * \param features  a N x M matrix containing N samples with M</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">     *                  features</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">     * \param labels    a N x D matrix containing the corresponding</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">     *                  N labels. Current split functors assume D to</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">     *                  be 1 and ignore any additional columns.</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">     *                  this is not enforced to allow future support</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">     *                  for uncertain labels.</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">     * learning is done with:</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">     * \sa rf::split, EarlyStoppStd</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">     * - Randomly seeded random number generator</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">     * - default gini split functor as described by Breiman</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">     * - default The standard early stopping criterion</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> U2,<span class="keyword">class</span> C2&gt;</div>
<div class="line"><a name="l00526"></a><span class="lineno"><a class="code" href="group__MachineLearning.html#gae480948c60eee838463b03a4593ee507">  526</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05" title="learn on data with custom config and random number generator">learn</a>(   <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C1&gt;</a> <span class="keyword">const</span>  &amp; features,</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                    <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U2,C2&gt;</a> <span class="keyword">const</span>  &amp; labels)</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05" title="learn on data with custom config and random number generator">learn</a>(  features, </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                labels, </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>(), </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>(), </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>());</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    }</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">/*\}*/</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">    /**\name prediction</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="comment">/*\{*/</span><span class="comment"></span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">    /** \brief predict a label given a feature.</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">     * \param features: a 1 by featureCount matrix containing</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">     *        data point to be predicted (this only works in</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">     *        classification setting)</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">     * \param stop: early stopping criterion</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">     * \return double value representing class. You can use the</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">     *         predictLabels() function together with the</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">     *         rf.external_parameter().class_type_ attribute</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">     *         to get back the same type used during learning. </span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C, <span class="keyword">class</span> Stop&gt;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    LabelType <a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645" title="predict a label given a feature.">predictLabel</a>(<a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C&gt;</a><span class="keyword">const</span> &amp; features, Stop &amp; stop) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C&gt;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    LabelType <a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645" title="predict a label given a feature.">predictLabel</a>(<a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C&gt;</a><span class="keyword">const</span> &amp; features)</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645" title="predict a label given a feature.">predictLabel</a>(features, <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>()); </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    } <span class="comment"></span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">    /** \brief predict a label with features and class priors</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">     * \param features: same as above.</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">     * \param prior:   iterator to prior weighting of classes</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">     * \return sam as above.</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C&gt;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    LabelType <a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645" title="predict a label given a feature.">predictLabel</a>(MultiArrayView&lt;2, U, C&gt; <span class="keyword">const</span> &amp; features,</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                ArrayVectorView&lt;double&gt; prior) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">    /** \brief predict multiple labels with given features</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">     * \param features: a n by featureCount matrix containing</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">     *        data point to be predicted (this only works in</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">     *        classification setting)</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">     * \param labels: a n by 1 matrix passed by reference to store</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">     *        output.</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">     * If the input contains an NaN value, an precondition exception is thrown.</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> T, <span class="keyword">class</span> C2&gt;</div>
<div class="line"><a name="l00582"></a><span class="lineno"><a class="code" href="group__MachineLearning.html#gaa2a5fc3a96d247c319c27c5bde7fab4e">  582</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#gaa2a5fc3a96d247c319c27c5bde7fab4e" title="predict multiple labels with given features">predictLabels</a>(<a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C1&gt;</a><span class="keyword">const</span> &amp; features,</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                       <a class="code" href="classvigra_1_1MultiArrayView.html">MultiArrayView&lt;2, T, C2&gt;</a> &amp; labels)<span class="keyword"> const</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        vigra_precondition(features.<a class="code" href="classvigra_1_1MultiArrayView.html#a53c8f0d5c70f10f31fbc246cbe524e32">shape</a>(0) == labels.<a class="code" href="classvigra_1_1MultiArrayView.html#a53c8f0d5c70f10f31fbc246cbe524e32">shape</a>(0),</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <span class="stringliteral">&quot;RandomForest::predictLabels(): Label array has wrong size.&quot;</span>);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;features.<a class="code" href="classvigra_1_1MultiArrayView.html#a53c8f0d5c70f10f31fbc246cbe524e32">shape</a>(0); ++k)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            vigra_precondition(!detail::contains_nan(<a class="code" href="group__LinearAlgebraFunctions.html#ga8cc5e13ed0643c0d9b8c9021eaae625d">rowVector</a>(features, k)),</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                <span class="stringliteral">&quot;RandomForest::predictLabels(): NaN in feature matrix.&quot;</span>);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            labels(k,0) = detail::RequiresExplicitCast&lt;T&gt;::cast(<a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645" title="predict a label given a feature.">predictLabel</a>(<a class="code" href="group__LinearAlgebraFunctions.html#ga8cc5e13ed0643c0d9b8c9021eaae625d">rowVector</a>(features, k), <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>()));</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">    /** \brief predict multiple labels with given features</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">     * \param features: a n by featureCount matrix containing</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">     *        data point to be predicted (this only works in</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">     *        classification setting)</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">     * \param labels: a n by 1 matrix passed by reference to store</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">     *        output.</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">     * \param nanLabel: label to be returned for the row of the input that</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">     *        contain an NaN value.</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> T, <span class="keyword">class</span> C2&gt;</div>
<div class="line"><a name="l00606"></a><span class="lineno"><a class="code" href="group__MachineLearning.html#ga3f2129f1cac1e9f3b0d5ef78fc81460c">  606</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#gaa2a5fc3a96d247c319c27c5bde7fab4e" title="predict multiple labels with given features">predictLabels</a>(<a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C1&gt;</a><span class="keyword">const</span> &amp; features,</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                       <a class="code" href="classvigra_1_1MultiArrayView.html">MultiArrayView&lt;2, T, C2&gt;</a> &amp; labels,</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                       LabelType nanLabel)<span class="keyword"> const</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        vigra_precondition(features.<a class="code" href="classvigra_1_1MultiArrayView.html#a53c8f0d5c70f10f31fbc246cbe524e32">shape</a>(0) == labels.<a class="code" href="classvigra_1_1MultiArrayView.html#a53c8f0d5c70f10f31fbc246cbe524e32">shape</a>(0),</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="stringliteral">&quot;RandomForest::predictLabels(): Label array has wrong size.&quot;</span>);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;features.<a class="code" href="classvigra_1_1MultiArrayView.html#a53c8f0d5c70f10f31fbc246cbe524e32">shape</a>(0); ++k)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            <span class="keywordflow">if</span>(detail::contains_nan(<a class="code" href="group__LinearAlgebraFunctions.html#ga8cc5e13ed0643c0d9b8c9021eaae625d">rowVector</a>(features, k)))</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                labels(k,0) = nanLabel;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                labels(k,0) = detail::RequiresExplicitCast&lt;T&gt;::cast(<a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645" title="predict a label given a feature.">predictLabel</a>(<a class="code" href="group__LinearAlgebraFunctions.html#ga8cc5e13ed0643c0d9b8c9021eaae625d">rowVector</a>(features, k), <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>()));</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">    /** \brief predict multiple labels with given features</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">     * \param features: a n by featureCount matrix containing</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">     *        data point to be predicted (this only works in</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">     *        classification setting)</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">     * \param labels: a n by 1 matrix passed by reference to store</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">     *        output.</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">     * \param stop: an early stopping criterion.</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> T, <span class="keyword">class</span> C2, <span class="keyword">class</span> Stop&gt;</div>
<div class="line"><a name="l00631"></a><span class="lineno"><a class="code" href="group__MachineLearning.html#ga20542164f24478948190079e3ba311b2">  631</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#gaa2a5fc3a96d247c319c27c5bde7fab4e" title="predict multiple labels with given features">predictLabels</a>(<a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C1&gt;</a><span class="keyword">const</span> &amp; features,</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                       <a class="code" href="classvigra_1_1MultiArrayView.html">MultiArrayView&lt;2, T, C2&gt;</a> &amp; labels,</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                       Stop                     &amp; stop)<span class="keyword"> const</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        vigra_precondition(features.<a class="code" href="classvigra_1_1MultiArrayView.html#a53c8f0d5c70f10f31fbc246cbe524e32">shape</a>(0) == labels.<a class="code" href="classvigra_1_1MultiArrayView.html#a53c8f0d5c70f10f31fbc246cbe524e32">shape</a>(0),</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <span class="stringliteral">&quot;RandomForest::predictLabels(): Label array has wrong size.&quot;</span>);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;features.<a class="code" href="classvigra_1_1MultiArrayView.html#a53c8f0d5c70f10f31fbc246cbe524e32">shape</a>(0); ++k)</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            labels(k,0) = detail::RequiresExplicitCast&lt;T&gt;::cast(<a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645" title="predict a label given a feature.">predictLabel</a>(<a class="code" href="group__LinearAlgebraFunctions.html#ga8cc5e13ed0643c0d9b8c9021eaae625d">rowVector</a>(features, k), stop));</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    }<span class="comment"></span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">    /** \brief predict the class probabilities for multiple labels</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">     *  \param features same as above</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">     *  \param prob a n x class_count_ matrix. passed by reference to</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">     *  save class probabilities</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">     *  \param stop earlystopping criterion</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">     *  \sa EarlyStopping</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">     </span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">        When a row of the feature array contains an NaN, the corresponding instance</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">        cannot belong to any of the classes. The corresponding row in the probability </span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">        array will therefore contain all zeros.</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> T, <span class="keyword">class</span> C2, <span class="keyword">class</span> Stop&gt;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga30e310de1642021af2e24d56be57a37d" title="predict the class probabilities for multiple labels">predictProbabilities</a>(<a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C1&gt;</a><span class="keyword">const</span> &amp;   features,</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                              <a class="code" href="classvigra_1_1MultiArrayView.html">MultiArrayView&lt;2, T, C2&gt;</a> &amp;        prob,</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                              Stop                     &amp;        stop) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T1,<span class="keyword">class</span> T2, <span class="keyword">class</span> C&gt;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga30e310de1642021af2e24d56be57a37d" title="predict the class probabilities for multiple labels">predictProbabilities</a>(OnlinePredictionSet&lt;T1&gt; &amp;  predictionSet,</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                               <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, T2, C&gt;</a> &amp;       prob);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">    /** \brief predict the class probabilities for multiple labels</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">     *  \param features same as above</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">     *  \param prob a n x class_count_ matrix. passed by reference to</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">     *  save class probabilities</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> T, <span class="keyword">class</span> C2&gt;</div>
<div class="line"><a name="l00667"></a><span class="lineno"><a class="code" href="group__MachineLearning.html#gaf3fb598fb45d272f6f6745321cbc8b81">  667</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga30e310de1642021af2e24d56be57a37d" title="predict the class probabilities for multiple labels">predictProbabilities</a>(<a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C1&gt;</a><span class="keyword">const</span> &amp;   features,</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                              <a class="code" href="classvigra_1_1MultiArrayView.html">MultiArrayView&lt;2, T, C2&gt;</a> &amp;        prob)<span class="keyword">  const</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <a class="code" href="group__MachineLearning.html#ga30e310de1642021af2e24d56be57a37d" title="predict the class probabilities for multiple labels">predictProbabilities</a>(features, prob, <a class="code" href="namespacevigra.html#ae19ed2482e705ffa14000822902fc131" title="factory function to return a RF_DEFAULT tag">rf_default</a>()); </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    }   </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> T, <span class="keyword">class</span> C2&gt;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordtype">void</span> predictRaw(<a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C1&gt;</a><span class="keyword">const</span> &amp;   features,</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                    <a class="code" href="classvigra_1_1MultiArrayView.html">MultiArrayView&lt;2, T, C2&gt;</a> &amp;        prob)  <span class="keyword">const</span>;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">/*\}*/</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;};</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> LabelType, <span class="keyword">class</span> PreprocessorTag&gt;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class </span>U,<span class="keyword">class </span>C1,</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keyword">class </span>U2, <span class="keyword">class </span>C2,</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keyword">class </span>Split_t,</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keyword">class </span>Stop_t,</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keyword">class </span>Visitor_t,</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keyword">class </span>Random_t&gt;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="keywordtype">void</span> RandomForest&lt;LabelType, PreprocessorTag&gt;::onlineLearn(MultiArrayView&lt;2,U,C1&gt; <span class="keyword">const</span> &amp; features,</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                                                             MultiArrayView&lt;2,U2,C2&gt; <span class="keyword">const</span> &amp; response,</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                                                             <span class="keywordtype">int</span> new_start_index,</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                                                             Visitor_t visitor_,</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                                                             Split_t split_,</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                                                             Stop_t stop_,</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                                                             Random_t &amp; random,</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                                                             <span class="keywordtype">bool</span> adjust_thresholds)</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;{</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    online_visitor_.activate();</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    online_visitor_.adjust_thresholds=adjust_thresholds;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keyword">using namespace </span>rf;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="comment">//typedefs</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keyword">typedef</span> Processor&lt;PreprocessorTag,LabelType,U,C1,U2,C2&gt; Preprocessor_t;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keyword">typedef</span>          UniformIntRandomFunctor&lt;Random_t&gt;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                                                    RandFunctor_t;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="comment">// default values and initialization</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="comment">// Value Chooser chooses second argument as value if first argument</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="comment">// is of type RF_DEFAULT. (thanks to template magic - don&#39;t care about</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">// it - just smile and wave.</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="preprocessor">    #define RF_CHOOSER(type_) detail::Value_Chooser&lt;type_, Default_##type_&gt; </span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="preprocessor"></span>    Default_Stop_t default_stop(options_);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keyword">typename</span> RF_CHOOSER(Stop_t)::type stop</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            = RF_CHOOSER(Stop_t)::choose(stop_, default_stop); </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    Default_Split_t default_split;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keyword">typename</span> RF_CHOOSER(Split_t)::type split </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            = RF_CHOOSER(Split_t)::choose(split_, default_split); </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    rf::visitors::StopVisiting stopvisiting;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keyword">typedef</span>  rf::visitors::detail::VisitorNode</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                &lt;rf::visitors::OnlineLearnVisitor, </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                 <span class="keyword">typename</span> RF_CHOOSER(Visitor_t)::type&gt; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                                                        IntermedVis; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    IntermedVis</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        visitor(online_visitor_, RF_CHOOSER(Visitor_t)::choose(visitor_, stopvisiting));</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="preprocessor">    #undef RF_CHOOSER</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="comment">// Preprocess the data to get something the split functor can work</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">// with. Also fill the ext_param structure by preprocessing</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="comment">// option parameters that could only be completely evaluated</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="comment">// when the training data is known.</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    ext_param_.class_count_=0;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    Preprocessor_t preprocessor(    features, response,</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                                    options_, ext_param_);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="comment">// Make stl compatible random functor.</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    RandFunctor_t           randint     ( random);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="comment">// Give the Split functor information about the data.</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    split.set_external_parameters(ext_param_);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    stop.set_external_parameters(ext_param_);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="comment">//Create poisson samples</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    PoissonSampler&lt;RandomTT800&gt; poisson_sampler(1.0,<a class="code" href="group__FixedSizeInt.html#ga92f05c4b6944ec5926841e34f03a9060" title="32-bit signed int">vigra::Int32</a>(new_start_index),<a class="code" href="group__FixedSizeInt.html#ga92f05c4b6944ec5926841e34f03a9060" title="32-bit signed int">vigra::Int32</a>(ext_param().row_count_));</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="comment">//TODO: visitors for online learning</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="comment">//visitor.visit_at_beginning(*this, preprocessor);</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="comment">// THE MAIN EFFING RF LOOP - YEAY DUDE!</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii = 0; ii &lt; (int)trees_.size(); ++ii)</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        online_visitor_.tree_id=ii;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        poisson_sampler.sample();</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        std::map&lt;int,int&gt; leaf_parents;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        leaf_parents.clear();</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="comment">//Get all the leaf nodes for that sample</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0;s&lt;poisson_sampler.numOfSamples();++s)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="keywordtype">int</span> sample=poisson_sampler[s];</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            online_visitor_.current_label=preprocessor.response()(sample,0);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            online_visitor_.last_node_id=StackEntry_t::DecisionTreeNoParent;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            <span class="keywordtype">int</span> leaf=trees_[ii].getToLeaf(<a class="code" href="group__LinearAlgebraFunctions.html#ga8cc5e13ed0643c0d9b8c9021eaae625d">rowVector</a>(features,sample),online_visitor_);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <span class="comment">//Add to the list for that leaf</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            online_visitor_.add_to_index_list(ii,leaf,sample);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="comment">//TODO: Class count?</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <span class="comment">//Store parent</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="keywordflow">if</span>(Node&lt;e_ConstProbNode&gt;(trees_[ii].topology_,trees_[ii].parameters_,leaf).prob_begin()[preprocessor.response()(sample,0)]!=1.0)</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                leaf_parents[leaf]=online_visitor_.last_node_id;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            }</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        std::map&lt;int,int&gt;::iterator leaf_iterator;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="keywordflow">for</span>(leaf_iterator=leaf_parents.begin();leaf_iterator!=leaf_parents.end();++leaf_iterator)</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="keywordtype">int</span> leaf=leaf_iterator-&gt;first;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <span class="keywordtype">int</span> parent=leaf_iterator-&gt;second;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <span class="keywordtype">int</span> lin_index=online_visitor_.trees_online_information[ii].exterior_to_index[leaf];</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            ArrayVector&lt;Int32&gt; indeces;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            indeces.clear();</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            indeces.swap(online_visitor_.trees_online_information[ii].index_lists[lin_index]);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            StackEntry_t stack_entry(indeces.begin(),</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                                     indeces.end(),</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                                     ext_param_.class_count_);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            <span class="keywordflow">if</span>(parent!=-1)</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                <span class="keywordflow">if</span>(NodeBase(trees_[ii].topology_,trees_[ii].parameters_,parent).child(0)==leaf)</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                    stack_entry.leftParent=parent;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                    vigra_assert(NodeBase(trees_[ii].topology_,trees_[ii].parameters_,parent).child(1)==leaf,<span class="stringliteral">&quot;last_node_id seems to be wrong&quot;</span>);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                    stack_entry.rightParent=parent;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                }</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            }</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            <span class="comment">//trees_[ii].continueLearn(preprocessor.features(),preprocessor.response(),stack_entry,split,stop,visitor,randint,leaf);</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            trees_[ii].continueLearn(preprocessor.features(),preprocessor.response(),stack_entry,split,stop,visitor,randint,-1);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="comment">//Now, the last one moved onto leaf</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            online_visitor_.move_exterior_node(ii,trees_[ii].topology_.size(),ii,leaf);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <span class="comment">//Now it should be classified correctly!</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        }</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="comment">/*visitor</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment">            .visit_after_tree(  *this,</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment">                                preprocessor,</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment">                                poisson_sampler,</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment">                                stack_entry,</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment">                                ii);*/</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="comment">//visitor.visit_at_end(*this, preprocessor);</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    online_visitor_.deactivate();</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;}</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> LabelType, <span class="keyword">class</span> PreprocessorTag&gt;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class </span>U,<span class="keyword">class </span>C1,</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keyword">class </span>U2, <span class="keyword">class </span>C2,</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keyword">class </span>Split_t,</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keyword">class </span>Stop_t,</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keyword">class </span>Visitor_t,</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keyword">class </span>Random_t&gt;</div>
<div class="line"><a name="l00829"></a><span class="lineno"><a class="code" href="group__MachineLearning.html#gae1ccc1e1d0b2d4aaec94005e775b4db2">  829</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#gae1ccc1e1d0b2d4aaec94005e775b4db2">RandomForest&lt;LabelType, PreprocessorTag&gt;::reLearnTree</a>(<a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2,U,C1&gt;</a> <span class="keyword">const</span> &amp; features,</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                 <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2,U2,C2&gt;</a> <span class="keyword">const</span> &amp; response,</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                 <span class="keywordtype">int</span> treeId,</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                 Visitor_t visitor_,</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                 Split_t split_,</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                 Stop_t stop_,</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                 Random_t &amp; random)</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;{</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keyword">using namespace </span>rf;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keyword">typedef</span>          <a class="code" href="classvigra_1_1UniformIntRandomFunctor.html">UniformIntRandomFunctor&lt;Random_t&gt;</a></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                                                    RandFunctor_t;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="comment">// See rf_preprocessing.hxx for more info on this</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    ext_param_.class_count_=0;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1Processor.html">Processor&lt;PreprocessorTag,LabelType, U, C1, U2, C2&gt;</a> Preprocessor_t;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    </div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="comment">// default values and initialization</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="comment">// Value Chooser chooses second argument as value if first argument</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="comment">// is of type RF_DEFAULT. (thanks to template magic - don&#39;t care about</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="comment">// it - just smile and wave.</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="preprocessor">    #define RF_CHOOSER(type_) detail::Value_Chooser&lt;type_, Default_##type_&gt; </span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="preprocessor"></span>    <a class="code" href="classvigra_1_1EarlyStoppStd.html" title="Standard early stopping criterion.">Default_Stop_t</a> default_stop(options_);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keyword">typename</span> RF_CHOOSER(Stop_t)::type stop</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            = RF_CHOOSER(Stop_t)::choose(stop_, default_stop); </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="classvigra_1_1ThresholdSplit.html">Default_Split_t</a> default_split;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="keyword">typename</span> RF_CHOOSER(Split_t)::type split </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            = RF_CHOOSER(Split_t)::choose(split_, default_split); </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <a class="code" href="classvigra_1_1rf_1_1visitors_1_1StopVisiting.html">rf::visitors::StopVisiting</a> stopvisiting;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keyword">typedef</span>  <a class="code" href="classvigra_1_1rf_1_1visitors_1_1detail_1_1VisitorNode.html">rf::visitors::detail::VisitorNode</a></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                &lt;<a class="code" href="classvigra_1_1rf_1_1visitors_1_1OnlineLearnVisitor.html">rf::visitors::OnlineLearnVisitor</a>, </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                <span class="keyword">typename</span> RF_CHOOSER(Visitor_t)::type&gt; IntermedVis; </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    IntermedVis</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        visitor(online_visitor_, RF_CHOOSER(Visitor_t)::choose(visitor_, stopvisiting));</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="preprocessor">    #undef RF_CHOOSER</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="preprocessor"></span>    vigra_precondition(options_.prepare_online_learning_,<span class="stringliteral">&quot;reLearnTree: Re learning trees only makes sense, if online learning is enabled&quot;</span>);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    online_visitor_.activate();</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="comment">// Make stl compatible random functor.</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    RandFunctor_t           randint     ( random);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// Preprocess the data to get something the split functor can work</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="comment">// with. Also fill the ext_param structure by preprocessing</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="comment">// option parameters that could only be completely evaluated</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">// when the training data is known.</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    Preprocessor_t preprocessor(    features, response,</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                                    options_, ext_param_);</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="comment">// Give the Split functor information about the data.</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    split.set_external_parameters(ext_param_);</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    stop.set_external_parameters(ext_param_);</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment">    /**\todo    replace this crappy class out. It uses function pointers.</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">     *          and is making code slower according to me.</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">     *          Comment from Nathan: This is copied from Rahul, so me=Rahul</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <a class="code" href="classvigra_1_1Sampler.html" title="Create random samples from a sequence of indices.">Sampler&lt;Random_t &gt;</a> sampler(preprocessor.strata().begin(),</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                               preprocessor.strata().end(),</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                               detail::make_sampler_opt(options_)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                                        .sampleSize(ext_param().actual_msample_),</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                               &amp;random);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="comment">//initialize First region/node/stack entry</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    sampler</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        .<a class="code" href="group__MachineLearning.html#ga50a2ce599e896bfb535e70a42003ed23">sample</a>();</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <a class="code" href="classvigra_1_1DT__StackEntry.html">StackEntry_t</a></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        first_stack_entry(  sampler.sampledIndices().begin(),</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                            sampler.sampledIndices().end(),</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                            ext_param_.class_count_);</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    first_stack_entry</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        .set_oob_range(     sampler.oobIndices().begin(),</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                            sampler.oobIndices().end());</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    online_visitor_.reset_tree(treeId);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    online_visitor_.tree_id=treeId;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    trees_[treeId].reset();</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    trees_[treeId]</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        .learn( preprocessor.features(),</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                preprocessor.response(),</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                first_stack_entry,</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                split,</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                stop,</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                visitor,</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                randint);</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    visitor</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        .visit_after_tree(  *<span class="keyword">this</span>,</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                            preprocessor,</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                            sampler,</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                            first_stack_entry,</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                            treeId);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    online_visitor_.deactivate();</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;}</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> LabelType, <span class="keyword">class</span> PreprocessorTag&gt;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class </span>U, <span class="keyword">class </span>C1,</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;         <span class="keyword">class </span>U2,<span class="keyword">class </span>C2,</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;         <span class="keyword">class </span>Split_t,</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;         <span class="keyword">class </span>Stop_t,</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;         <span class="keyword">class </span>Visitor_t,</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;         <span class="keyword">class </span>Random_t&gt;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05" title="learn on data with custom config and random number generator">RandomForest&lt;LabelType, PreprocessorTag&gt;::</a></div>
<div class="line"><a name="l00932"></a><span class="lineno"><a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05">  932</a></span>&#160;<a class="code" href="group__MachineLearning.html#ga11157c680b4f47c5592d6695b5fbac05" title="learn on data with custom config and random number generator">                     learn</a>( <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C1&gt;</a> <span class="keyword">const</span>  &amp;   features,</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                            <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U2,C2&gt;</a> <span class="keyword">const</span>  &amp;   response,</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                            Visitor_t                           visitor_,</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                            Split_t                             split_,</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                            Stop_t                              stop_,</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                            Random_t                 <span class="keyword">const</span>  &amp;   random)</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;{</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="keyword">using namespace </span>rf;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="comment">//this-&gt;reset();</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="comment">//typedefs</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keyword">typedef</span>          <a class="code" href="classvigra_1_1UniformIntRandomFunctor.html">UniformIntRandomFunctor&lt;Random_t&gt;</a></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                                                    RandFunctor_t;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="comment">// See rf_preprocessing.hxx for more info on this</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1Processor.html">Processor&lt;PreprocessorTag,LabelType, U, C1, U2, C2&gt;</a> Preprocessor_t;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    vigra_precondition(features.<a class="code" href="classvigra_1_1MultiArrayView.html#a53c8f0d5c70f10f31fbc246cbe524e32">shape</a>(0) == response.<a class="code" href="classvigra_1_1MultiArrayView.html#a53c8f0d5c70f10f31fbc246cbe524e32">shape</a>(0),</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="stringliteral">&quot;RandomForest::learn(): shape mismatch between features and response.&quot;</span>);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="comment">// default values and initialization</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="comment">// Value Chooser chooses second argument as value if first argument</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="comment">// is of type RF_DEFAULT. (thanks to template magic - don&#39;t care about</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">// it - just smile and wave).</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    </div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="preprocessor">    #define RF_CHOOSER(type_) detail::Value_Chooser&lt;type_, Default_##type_&gt; </span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="preprocessor"></span>    <a class="code" href="classvigra_1_1EarlyStoppStd.html" title="Standard early stopping criterion.">Default_Stop_t</a> default_stop(options_);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keyword">typename</span> RF_CHOOSER(Stop_t)::type stop</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            = RF_CHOOSER(Stop_t)::choose(stop_, default_stop); </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <a class="code" href="classvigra_1_1ThresholdSplit.html">Default_Split_t</a> default_split;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keyword">typename</span> RF_CHOOSER(Split_t)::type split </div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            = RF_CHOOSER(Split_t)::choose(split_, default_split); </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <a class="code" href="classvigra_1_1rf_1_1visitors_1_1StopVisiting.html">rf::visitors::StopVisiting</a> stopvisiting;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keyword">typedef</span>  <a class="code" href="classvigra_1_1rf_1_1visitors_1_1detail_1_1VisitorNode.html">rf::visitors::detail::VisitorNode</a>&lt;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                <a class="code" href="classvigra_1_1rf_1_1visitors_1_1OnlineLearnVisitor.html">rf::visitors::OnlineLearnVisitor</a>, </div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                <span class="keyword">typename</span> RF_CHOOSER(Visitor_t)::type&gt; IntermedVis; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    IntermedVis</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        visitor(online_visitor_, RF_CHOOSER(Visitor_t)::choose(visitor_, stopvisiting));</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="preprocessor">    #undef RF_CHOOSER</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(options_.prepare_online_learning_)</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        online_visitor_.activate();</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        online_visitor_.deactivate();</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">// Make stl compatible random functor.</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    RandFunctor_t           randint     ( random);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="comment">// Preprocess the data to get something the split functor can work</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">// with. Also fill the ext_param structure by preprocessing</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="comment">// option parameters that could only be completely evaluated</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="comment">// when the training data is known.</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    Preprocessor_t preprocessor(    features, response,</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                                    options_, ext_param_);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">// Give the Split functor information about the data.</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    split.set_external_parameters(ext_param_);</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    stop.set_external_parameters(ext_param_);</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="comment">//initialize trees.</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    trees_.resize(options_.tree_count_  , DecisionTree_t(ext_param_));</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <a class="code" href="classvigra_1_1Sampler.html" title="Create random samples from a sequence of indices.">Sampler&lt;Random_t &gt;</a> sampler(preprocessor.strata().begin(),</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                               preprocessor.strata().end(),</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                               detail::make_sampler_opt(options_)</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                                        .sampleSize(ext_param().actual_msample_),</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                               &amp;random);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    visitor.visit_at_beginning(*<span class="keyword">this</span>, preprocessor);</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="comment">// THE MAIN EFFING RF LOOP - YEAY DUDE!</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii = 0; ii &lt; (int)trees_.size(); ++ii)</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    {</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <span class="comment">//initialize First region/node/stack entry</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        sampler</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            .<a class="code" href="group__MachineLearning.html#ga50a2ce599e896bfb535e70a42003ed23">sample</a>();  </div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <a class="code" href="classvigra_1_1DT__StackEntry.html">StackEntry_t</a></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            first_stack_entry(  sampler.sampledIndices().begin(),</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                                sampler.sampledIndices().end(),</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                                ext_param_.class_count_);</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        first_stack_entry</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            .set_oob_range(     sampler.oobIndices().begin(),</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                                sampler.oobIndices().end());</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        trees_[ii]</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            .learn(             preprocessor.features(),</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                                preprocessor.response(),</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                                first_stack_entry,</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                                split,</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                                stop,</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                                visitor,</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                                randint);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        visitor</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;            .visit_after_tree(  *<span class="keyword">this</span>,</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                                preprocessor,</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                                sampler,</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                                first_stack_entry,</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                                ii);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    }</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    visitor.visit_at_end(*<span class="keyword">this</span>, preprocessor);</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="comment">// Only for online learning?</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    online_visitor_.deactivate();</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;}</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> LabelType, <span class="keyword">class</span> Tag&gt;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C, <span class="keyword">class</span> Stop&gt;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;LabelType <a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645" title="predict a label given a feature.">RandomForest&lt;LabelType, Tag&gt;</a></div>
<div class="line"><a name="l01043"></a><span class="lineno"><a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645"> 1043</a></span>&#160;<a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645" title="predict a label given a feature.">    ::predictLabel</a>(<a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C&gt;</a> <span class="keyword">const</span> &amp; features, Stop &amp; stop)<span class="keyword"> const</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    vigra_precondition(<a class="code" href="group__LinearAlgebraFunctions.html#ga40eab6d0fc1e179c173a3b90c9d991be">columnCount</a>(features) &gt;= ext_param_.column_count_,</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        <span class="stringliteral">&quot;RandomForestn::predictLabel():&quot;</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            <span class="stringliteral">&quot; Too few columns in feature matrix.&quot;</span>);</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    vigra_precondition(<a class="code" href="group__LinearAlgebraFunctions.html#gaa88b5c1277c72b4d4e2b70c278efbffe">rowCount</a>(features) == 1,</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="stringliteral">&quot;RandomForestn::predictLabel():&quot;</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;            <span class="stringliteral">&quot; Feature matrix must have a singlerow.&quot;</span>);</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <a class="code" href="classvigra_1_1MultiArray.html">MultiArray&lt;2, double&gt;</a> probabilities(<a class="code" href="group__MultiIteratorGroup.html#ga2e2ffc107bb0e38f9b1288b647c8ec5b" title="shape type for MultiArray&lt;2, T&gt;">Shape2</a>(1, ext_param_.class_count_), 0.0);</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    LabelType          d;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    predictProbabilities(features, probabilities, stop);</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    ext_param_.to_classlabel(<a class="code" href="group__MathFunctions.html#gaf658d43400902a049a289c4e5ded84d9" title="Find the maximum element in a sequence.">argMax</a>(probabilities), d);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="keywordflow">return</span> d;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;}</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">//Same thing as above with priors for each label !!!</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> LabelType, <span class="keyword">class</span> PreprocessorTag&gt;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C&gt;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;LabelType <a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645" title="predict a label given a feature.">RandomForest&lt;LabelType, PreprocessorTag&gt;</a></div>
<div class="line"><a name="l01063"></a><span class="lineno"><a class="code" href="group__MachineLearning.html#ga75ac70b9d658f75208f5ffb5a15adbe2"> 1063</a></span>&#160;<a class="code" href="group__MachineLearning.html#gaf79cd1eb1287d9d26dd90be5cb971645" title="predict a label given a feature.">    ::predictLabel</a>( <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, U, C&gt;</a> <span class="keyword">const</span> &amp; features,</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                    <a class="code" href="classvigra_1_1ArrayVectorView.html">ArrayVectorView&lt;double&gt;</a> priors)<span class="keyword"> const</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keyword">using namespace </span>functor;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    vigra_precondition(<a class="code" href="group__LinearAlgebraFunctions.html#ga40eab6d0fc1e179c173a3b90c9d991be">columnCount</a>(features) &gt;= ext_param_.column_count_,</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        <span class="stringliteral">&quot;RandomForestn::predictLabel(): Too few columns in feature matrix.&quot;</span>);</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    vigra_precondition(<a class="code" href="group__LinearAlgebraFunctions.html#gaa88b5c1277c72b4d4e2b70c278efbffe">rowCount</a>(features) == 1,</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        <span class="stringliteral">&quot;RandomForestn::predictLabel():&quot;</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="stringliteral">&quot; Feature matrix must have a single row.&quot;</span>);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    Matrix&lt;double&gt;  prob(1,ext_param_.class_count_);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    predictProbabilities(features, prob);</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    std::transform( prob.begin(), prob.end(),</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                    priors.<a class="code" href="classvigra_1_1ArrayVectorView.html#aa4b02d4f1a8500fb07a551069060709f">begin</a>(), prob.begin(),</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;                    Arg1()*Arg2());</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    LabelType          d;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    ext_param_.to_classlabel(<a class="code" href="group__MathFunctions.html#gaf658d43400902a049a289c4e5ded84d9" title="Find the maximum element in a sequence.">argMax</a>(prob), d);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="keywordflow">return</span> d;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;}</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> LabelType,<span class="keyword">class</span> PreprocessorTag&gt;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> T1,<span class="keyword">class</span> T2, <span class="keyword">class</span> C&gt;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga30e310de1642021af2e24d56be57a37d" title="predict the class probabilities for multiple labels">RandomForest&lt;LabelType,PreprocessorTag&gt;</a></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<a class="code" href="group__MachineLearning.html#ga30e310de1642021af2e24d56be57a37d" title="predict the class probabilities for multiple labels">    ::predictProbabilities</a>(OnlinePredictionSet&lt;T1&gt; &amp;  predictionSet,</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                          <a class="code" href="classvigra_1_1MultiArrayView.html" title="Base class for, and view to, vigra::MultiArray.">MultiArrayView&lt;2, T2, C&gt;</a> &amp;       prob)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;{</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="comment">//Features are n xp</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">//prob is n x NumOfLabel probability for each feature in each class</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    </div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    vigra_precondition(<a class="code" href="group__LinearAlgebraFunctions.html#gaa88b5c1277c72b4d4e2b70c278efbffe">rowCount</a>(predictionSet.features) == <a class="code" href="group__LinearAlgebraFunctions.html#gaa88b5c1277c72b4d4e2b70c278efbffe">rowCount</a>(prob),</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                       <span class="stringliteral">&quot;RandomFroest::predictProbabilities():&quot;</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                       <span class="stringliteral">&quot; Feature matrix and probability matrix size mismatch.&quot;</span>);</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="comment">// num of features must be bigger than num of features in Random forest training</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="comment">// but why bigger?</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    vigra_precondition( <a class="code" href="group__LinearAlgebraFunctions.html#ga40eab6d0fc1e179c173a3b90c9d991be">columnCount</a>(predictionSet.features) &gt;= ext_param_.column_count_,</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      <span class="stringliteral">&quot;RandomForestn::predictProbabilities():&quot;</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        <span class="stringliteral">&quot; Too few columns in feature matrix.&quot;</span>);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    vigra_precondition( <a class="code" href="group__LinearAlgebraFunctions.html#ga40eab6d0fc1e179c173a3b90c9d991be">columnCount</a>(prob)</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                        == (<a class="code" href="group__MultiIteratorGroup.html#gac436173a0374e960a463a9186496ab70">MultiArrayIndex</a>)ext_param_.class_count_,</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="stringliteral">&quot;RandomForestn::predictProbabilities():&quot;</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      <span class="stringliteral">&quot; Probability matrix must have as many columns as there are classes.&quot;</span>);</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    prob.<a class="code" href="classvigra_1_1MultiArrayView.html#ae8d75c08347781b9854c8aea98c34610">init</a>(0.0);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="comment">//store total weights</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    std::vector&lt;T1&gt; totalWeights(predictionSet.indices[0].size(),0.0);</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="comment">//Go through all trees</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordtype">int</span> set_id=-1;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;options_.tree_count_; ++k)</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    {</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        set_id=(set_id+1) % predictionSet.indices[0].size();</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="keyword">typedef</span> std::set&lt;SampleRange&lt;T1&gt; &gt; my_set;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <span class="keyword">typedef</span> <span class="keyword">typename</span> my_set::iterator set_it;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="comment">//typedef std::set&lt;std::pair&lt;int,SampleRange&lt;T1&gt; &gt; &gt;::iterator set_it;</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <span class="comment">//Build a stack with all the ranges we have</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        std::vector&lt;std::pair&lt;int,set_it&gt; &gt; stack;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        stack.clear();</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="keywordflow">for</span>(set_it i=predictionSet.ranges[set_id].begin();</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;             i!=predictionSet.ranges[set_id].end();++i)</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            stack.push_back(std::pair&lt;int,set_it&gt;(2,i));</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <span class="comment">//get weights predicted by single tree</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="keywordtype">int</span> num_decisions=0;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        <span class="keywordflow">while</span>(!stack.empty())</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        {</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            set_it range=stack.back().second;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;            <span class="keywordtype">int</span> index=stack.back().first;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            stack.pop_back();</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            ++num_decisions;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;            <span class="keywordflow">if</span>(trees_[k].isLeafNode(trees_[k].topology_[index]))</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;            {</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                <a class="code" href="classvigra_1_1ArrayVector.html">ArrayVector&lt;double&gt;::iterator</a> weights=<a class="code" href="classvigra_1_1Node_3_01e__ConstProbNode_01_4.html">Node&lt;e_ConstProbNode&gt;</a>(trees_[k].topology_,</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                                                                            trees_[k].parameters_,</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                                                                            index).prob_begin();</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=range-&gt;start;i!=range-&gt;end;++i)</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                {</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                    <span class="comment">//update votecount.</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0; l&lt;ext_param_.class_count_; ++l)</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                    {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                        prob(predictionSet.indices[set_id][i], l) += (T2)weights[l];</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                        <span class="comment">//every weight in totalWeight.</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                        totalWeights[predictionSet.indices[set_id][i]] += (T1)weights[l];</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                    }</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                }</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            }</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;            {</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                <span class="keywordflow">if</span>(trees_[k].topology_[index]!=i_ThresholdNode)</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                {</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;predicting with online prediction sets is only supported for RFs with threshold nodes&quot;</span>);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                }</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                Node&lt;i_ThresholdNode&gt; node(trees_[k].topology_,trees_[k].parameters_,index);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                <span class="keywordflow">if</span>(range-&gt;min_boundaries[node.column()]&gt;=node.threshold())</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                {</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                    <span class="comment">//Everything goes to right child</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                    stack.push_back(std::pair&lt;int,set_it&gt;(node.child(1),range));</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                }</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                <span class="keywordflow">if</span>(range-&gt;max_boundaries[node.column()]&lt;node.threshold())</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                {</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                    <span class="comment">//Everything goes to the left child</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                    stack.push_back(std::pair&lt;int,set_it&gt;(node.child(0),range));</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                }</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;                <span class="comment">//We have to split at this node</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                SampleRange&lt;T1&gt; new_range=*range;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                new_range.min_boundaries[node.column()]=FLT_MAX;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                range-&gt;max_boundaries[node.column()]=-FLT_MAX;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                new_range.start=new_range.end=range-&gt;end;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                <span class="keywordtype">int</span> i=range-&gt;start;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                <span class="keywordflow">while</span>(i!=range-&gt;end)</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                {</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                    <span class="comment">//Decide for range-&gt;indices[i]</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;                    <span class="keywordflow">if</span>(predictionSet.features(predictionSet.indices[set_id][i],node.column())&gt;=node.threshold())</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                    {</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                        new_range.min_boundaries[node.column()]=std::min(new_range.min_boundaries[node.column()],</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                                                                    predictionSet.features(predictionSet.indices[set_id][i],node.column()));</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                        --range-&gt;end;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                        --new_range.start;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                        std::swap(predictionSet.indices[set_id][i],predictionSet.indices[set_id][range-&gt;end]);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                    }</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                    {</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                        range-&gt;max_boundaries[node.column()]=std::max(range-&gt;max_boundaries[node.column()],</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                                                                 predictionSet.features(predictionSet.indices[set_id][i],node.column()));</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                        ++i;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                    }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                }</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                <span class="comment">//The old one ...</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                <span class="keywordflow">if</span>(range-&gt;start==range-&gt;end)</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                {</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                    predictionSet.ranges[set_id].erase(range);</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                }</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                {</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                    stack.push_back(std::pair&lt;int,set_it&gt;(node.child(0),range));</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                }</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                <span class="comment">//And the new one ...</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                <span class="keywordflow">if</span>(new_range.start!=new_range.end)</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                {</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                    std::pair&lt;set_it,bool&gt; new_it=predictionSet.ranges[set_id].insert(new_range);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                    stack.push_back(std::pair&lt;int,set_it&gt;(node.child(1),new_it.first));</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                }</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            }</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        predictionSet.cumulativePredTime[k]=num_decisions;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    }</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;totalWeights.size();++i)</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    {</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="keywordtype">double</span> test=0.0;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <span class="comment">//Normalise votes in each row by total VoteCount (totalWeight</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0; l&lt;ext_param_.class_count_; ++l)</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        {</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;            test+=prob(i,l);</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;            prob(i, l) /= totalWeights[i];</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        }</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        assert(test==totalWeights[i]);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        assert(totalWeights[i]&gt;0.0);</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;}</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> LabelType, <span class="keyword">class</span> PreprocessorTag&gt;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> T, <span class="keyword">class</span> C2, <span class="keyword">class</span> Stop_t&gt;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga30e310de1642021af2e24d56be57a37d" title="predict the class probabilities for multiple labels">RandomForest&lt;LabelType, PreprocessorTag&gt;</a></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<a class="code" href="group__MachineLearning.html#ga30e310de1642021af2e24d56be57a37d" title="predict the class probabilities for multiple labels">    ::predictProbabilities</a>(MultiArrayView&lt;2, U, C1&gt;<span class="keyword">const</span> &amp;  features,</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;                           MultiArrayView&lt;2, T, C2&gt; &amp;       prob,</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                           Stop_t                   &amp;       stop_)<span class="keyword"> const</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="comment">//Features are n xp</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="comment">//prob is n x NumOfLabel probability for each feature in each class</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    vigra_precondition(<a class="code" href="group__LinearAlgebraFunctions.html#gaa88b5c1277c72b4d4e2b70c278efbffe">rowCount</a>(features) == <a class="code" href="group__LinearAlgebraFunctions.html#gaa88b5c1277c72b4d4e2b70c278efbffe">rowCount</a>(prob),</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <span class="stringliteral">&quot;RandomForestn::predictProbabilities():&quot;</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <span class="stringliteral">&quot; Feature matrix and probability matrix size mismatch.&quot;</span>);</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <span class="comment">// num of features must be bigger than num of features in Random forest training</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="comment">// but why bigger?</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    vigra_precondition( <a class="code" href="group__LinearAlgebraFunctions.html#ga40eab6d0fc1e179c173a3b90c9d991be">columnCount</a>(features) &gt;= ext_param_.column_count_,</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      <span class="stringliteral">&quot;RandomForestn::predictProbabilities():&quot;</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        <span class="stringliteral">&quot; Too few columns in feature matrix.&quot;</span>);</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    vigra_precondition( <a class="code" href="group__LinearAlgebraFunctions.html#ga40eab6d0fc1e179c173a3b90c9d991be">columnCount</a>(prob)</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                        == (<a class="code" href="group__MultiIteratorGroup.html#gac436173a0374e960a463a9186496ab70">MultiArrayIndex</a>)ext_param_.class_count_,</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <span class="stringliteral">&quot;RandomForestn::predictProbabilities():&quot;</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      <span class="stringliteral">&quot; Probability matrix must have as many columns as there are classes.&quot;</span>);</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="preprocessor">    #define RF_CHOOSER(type_) detail::Value_Chooser&lt;type_, Default_##type_&gt; </span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="preprocessor"></span>    Default_Stop_t default_stop(options_);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keyword">typename</span> RF_CHOOSER(Stop_t)::type &amp; stop</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;            = RF_CHOOSER(Stop_t)::choose(stop_, default_stop); </div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="preprocessor">    #undef RF_CHOOSER </span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="preprocessor"></span>    stop.set_external_parameters(ext_param_, tree_count());</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    prob.init(NumericTraits&lt;T&gt;::zero());</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="comment">/* This code was originally there for testing early stopping</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">     * - we wanted the order of the trees to be randomized</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment">    if(tree_indices_.size() != 0)</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment">       std::random_shuffle(tree_indices_.begin(),</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">                           tree_indices_.end()); </span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="comment">//Classify for each row.</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> row=0; row &lt; <a class="code" href="group__LinearAlgebraFunctions.html#gaa88b5c1277c72b4d4e2b70c278efbffe">rowCount</a>(features); ++row)</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    {</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        MultiArrayView&lt;2, U, StridedArrayTag&gt; currentRow(<a class="code" href="group__LinearAlgebraFunctions.html#ga8cc5e13ed0643c0d9b8c9021eaae625d">rowVector</a>(features, row));</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        </div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <span class="comment">// when the features contain an NaN, the instance doesn&#39;t belong to any class</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        <span class="comment">// =&gt; indicate this by returning a zero probability array.</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        <span class="keywordflow">if</span>(detail::contains_nan(currentRow))</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        {</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;            <a class="code" href="group__LinearAlgebraFunctions.html#ga8cc5e13ed0643c0d9b8c9021eaae625d">rowVector</a>(prob, row).init(0.0);</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        }</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    </div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        ArrayVector&lt;double&gt;::const_iterator weights;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <span class="comment">//totalWeight == totalVoteCount!</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        <span class="keywordtype">double</span> totalWeight = 0.0;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <span class="comment">//Let each tree classify...</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;options_.tree_count_; ++k)</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        {</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            <span class="comment">//get weights predicted by single tree</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;            weights = trees_[k <span class="comment">/*tree_indices_[k]*/</span>].predict(currentRow);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;            <span class="comment">//update votecount.</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;            <span class="keywordtype">int</span> weighted = options_.predict_weighted_;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0; l&lt;ext_param_.class_count_; ++l)</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;            {</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                <span class="keywordtype">double</span> cur_w = weights[l] * (weighted * (*(weights-1))</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                                           + (1-weighted));</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                prob(row, l) += (T)cur_w;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                <span class="comment">//every weight in totalWeight.</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                totalWeight += cur_w;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;            }</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            <span class="keywordflow">if</span>(stop.after_prediction(weights, </div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                                     k,</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                                     <a class="code" href="group__LinearAlgebraFunctions.html#ga8cc5e13ed0643c0d9b8c9021eaae625d">rowVector</a>(prob, row),</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                                     totalWeight))</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;            {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            }</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        }</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        <span class="comment">//Normalise votes in each row by total VoteCount (totalWeight</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0; l&lt; ext_param_.class_count_; ++l)</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        {</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            prob(row, l) /= detail::RequiresExplicitCast&lt;T&gt;::cast(totalWeight);</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        }</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    }</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;}</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> LabelType, <span class="keyword">class</span> PreprocessorTag&gt;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> C1, <span class="keyword">class</span> T, <span class="keyword">class</span> C2&gt;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="keywordtype">void</span> RandomForest&lt;LabelType, PreprocessorTag&gt;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    ::predictRaw(MultiArrayView&lt;2, U, C1&gt;<span class="keyword">const</span> &amp;  features,</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                           MultiArrayView&lt;2, T, C2&gt; &amp;       prob)<span class="keyword"> const</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="comment">//Features are n xp</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="comment">//prob is n x NumOfLabel probability for each feature in each class</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    vigra_precondition(<a class="code" href="group__LinearAlgebraFunctions.html#gaa88b5c1277c72b4d4e2b70c278efbffe">rowCount</a>(features) == <a class="code" href="group__LinearAlgebraFunctions.html#gaa88b5c1277c72b4d4e2b70c278efbffe">rowCount</a>(prob),</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;      <span class="stringliteral">&quot;RandomForestn::predictProbabilities():&quot;</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        <span class="stringliteral">&quot; Feature matrix and probability matrix size mismatch.&quot;</span>);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="comment">// num of features must be bigger than num of features in Random forest training</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="comment">// but why bigger?</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    vigra_precondition( <a class="code" href="group__LinearAlgebraFunctions.html#ga40eab6d0fc1e179c173a3b90c9d991be">columnCount</a>(features) &gt;= ext_param_.column_count_,</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      <span class="stringliteral">&quot;RandomForestn::predictProbabilities():&quot;</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="stringliteral">&quot; Too few columns in feature matrix.&quot;</span>);</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    vigra_precondition( <a class="code" href="group__LinearAlgebraFunctions.html#ga40eab6d0fc1e179c173a3b90c9d991be">columnCount</a>(prob)</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;                        == (<a class="code" href="group__MultiIteratorGroup.html#gac436173a0374e960a463a9186496ab70">MultiArrayIndex</a>)ext_param_.class_count_,</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      <span class="stringliteral">&quot;RandomForestn::predictProbabilities():&quot;</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      <span class="stringliteral">&quot; Probability matrix must have as many columns as there are classes.&quot;</span>);</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="preprocessor">    #define RF_CHOOSER(type_) detail::Value_Chooser&lt;type_, Default_##type_&gt; </span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="preprocessor"></span>    prob.init(NumericTraits&lt;T&gt;::zero());</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="comment">/* This code was originally there for testing early stopping</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">     * - we wanted the order of the trees to be randomized</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">    if(tree_indices_.size() != 0)</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">       std::random_shuffle(tree_indices_.begin(),</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">                           tree_indices_.end()); </span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="comment">//Classify for each row.</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> row=0; row &lt; <a class="code" href="group__LinearAlgebraFunctions.html#gaa88b5c1277c72b4d4e2b70c278efbffe">rowCount</a>(features); ++row)</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    {</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        ArrayVector&lt;double&gt;::const_iterator weights;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="comment">//totalWeight == totalVoteCount!</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <span class="keywordtype">double</span> totalWeight = 0.0;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <span class="comment">//Let each tree classify...</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;options_.tree_count_; ++k)</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        {</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            <span class="comment">//get weights predicted by single tree</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            weights = trees_[k <span class="comment">/*tree_indices_[k]*/</span>].predict(<a class="code" href="group__LinearAlgebraFunctions.html#ga8cc5e13ed0643c0d9b8c9021eaae625d">rowVector</a>(features, row));</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;            <span class="comment">//update votecount.</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            <span class="keywordtype">int</span> weighted = options_.predict_weighted_;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0; l&lt;ext_param_.class_count_; ++l)</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            {</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                <span class="keywordtype">double</span> cur_w = weights[l] * (weighted * (*(weights-1))</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                                           + (1-weighted));</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                prob(row, l) += (T)cur_w;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                <span class="comment">//every weight in totalWeight.</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                totalWeight += cur_w;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;            }</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        }</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    }</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    prob/= options_.tree_count_;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;}</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">//@}</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;} <span class="comment">// namespace vigra</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="preprocessor">#include &quot;random_forest/rf_algorithm.hxx&quot;</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="preprocessor">#endif // VIGRA_RANDOM_FOREST_HXX</span></div>
</div><!-- fragment --></div><!-- contents -->
<!-- footer.html -->
<p>
<table border=0 cellspacing=0 width="100%"  bgcolor="#e0d0a0" cellpadding=5>
<tr>
<td>
<p>
<i>&copy; <A HREF="http://hci.iwr.uni-heidelberg.de/people/ukoethe/">Ullrich K&ouml;the</A>     (<A
HREF="mailto:ullrich.koethe@iwr.uni-heidelberg.de">ullrich.koethe@iwr.uni-heidelberg.de</A>)</i> <br>
<i><A HREF="http://hci.iwr.uni-heidelberg.de/">
Heidelberg Collaboratory for Image Processing</a>,
University of Heidelberg, Germany</i>
<td>
<p align=right>
<I>html generated using <A HREF="http://www.doxygen.org">doxygen</A> and <A HREF="http://www.python.org">Python</A></I>
<br>
<i>
vigra 1.9.1 (Thu Sep 5 2013)
</i>
</tr>
</table>
</BODY>
</HTML>
