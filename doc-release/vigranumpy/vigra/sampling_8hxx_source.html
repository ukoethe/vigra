<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><TITLE>vigra - vigra/sampling.hxx Source File</TITLE>
<link rel=stylesheet type="text/css" href="vigra.css">
<link rel=stylesheet type="text/css" href="vigra_1_8_2.css">
<link rel="shortcut icon" href="vigra-icon.ico" />
<script type="text/javascript">
function toggleHiddenDocumentation( textID, toggleID, toggleMessage )
{ 
	if( document.getElementById(textID).style.display == 'none' )
    {
		document.getElementById(textID).style.display = 'block';
        document.getElementById(toggleID).innerHTML = "hide " + toggleMessage;
    }
    else
    {
		document.getElementById(textID).style.display = 'none';
        document.getElementById(toggleID).innerHTML = "show " + toggleMessage;
	}
    return false;
}
</script>
</head>
<body  bgcolor="#f8f0e0" link="#0040b0" vlink="#a00040">
<basefont face="Helvetica,Arial,sans-serif" size=3>
<p align=right>
[ <a href="http://hci.iwr.uni-heidelberg.de/vigra/">VIGRA Homepage</a> |
 <a href="functionindex.html">Function Index</a> |
 <a href="classes.html">Class Index</a> |
 <a href="namespaces.html">Namespaces</a> |
 <a href="files.html">File List</a> |
 <a href="index.html">Main Page</a> ]
</p>
<!-- Generated by Doxygen 1.8.4 -->
</div><!-- top -->
<div class="contents">
<table class="main_heading">
<tr>
<td width="100%">sampling.hxx
</td>
<td align=right><a href="http://hci.iwr.uni-heidelberg.de/vigra/"><IMG border=0 ALT="VIGRA" SRC="documents/vigra.gif" title="VIGRA Homepage"></a></td></tr>
</table><p>

<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/************************************************************************/</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">/*        Copyright 2008-2009 by  Ullrich Koethe and Rahul Nair         */</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">/*    This file is part of the VIGRA computer vision library.           */</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">/*    The VIGRA Website is                                              */</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">/*        http://hci.iwr.uni-heidelberg.de/vigra/                       */</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">/*    Please direct questions, bug reports, and contributions to        */</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/*        ullrich.koethe@iwr.uni-heidelberg.de    or                    */</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">/*        vigra@informatik.uni-hamburg.de                               */</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/*    Permission is hereby granted, free of charge, to any person       */</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">/*    obtaining a copy of this software and associated documentation    */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/*    files (the &quot;Software&quot;), to deal in the Software without           */</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/*    restriction, including without limitation the rights to use,      */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/*    copy, modify, merge, publish, distribute, sublicense, and/or      */</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">/*    sell copies of the Software, and to permit persons to whom the    */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">/*    Software is furnished to do so, subject to the following          */</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*    conditions:                                                       */</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/*    The above copyright notice and this permission notice shall be    */</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/*    included in all copies or substantial portions of the             */</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">/*    Software.                                                         */</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">/*    THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND    */</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">/*    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES   */</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/*    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND          */</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">/*    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT       */</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">/*    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,      */</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">/*    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING      */</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">/*    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR     */</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">/*    OTHER DEALINGS IN THE SOFTWARE.                                   */</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">/*                                                                      */</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/************************************************************************/</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#ifndef VIGRA_SAMPLING_HXX</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VIGRA_SAMPLING_HXX</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;array_vector.hxx&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;random.hxx&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">namespace </span>vigra</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;{</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">/** \addtogroup MachineLearning Machine Learning</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">**/</span><span class="comment"></span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">//@{</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">/**\brief Options object for the Sampler class.</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">  &lt;b&gt;usage:&lt;/b&gt;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">  \code</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">  SamplerOptions opt =  SamplerOptions()</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">                               .withReplacement()</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">                               .sampleProportion(0.5);</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">  \endcode</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">  Note that the return value of all methods is &lt;tt&gt;*this&lt;/tt&gt; which makes</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">  concatenating of options as above possible.</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="code" href="classvigra_1_1SamplerOptions.html">   66</a></span>&#160;<span class="keyword">class </span><a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;{</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">double</span> sample_proportion;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sample_size;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">bool</span>   sample_with_replacement;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordtype">bool</span>   stratified_sampling;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a>()</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    : sample_proportion(1.0),</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      sample_size(0), </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      sample_with_replacement(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      stratified_sampling(<span class="keyword">false</span>)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    {}</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">        /**\brief Sample from training population with replacement.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">         * &lt;br&gt; Default: true</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="code" href="classvigra_1_1SamplerOptions.html#a71724571dc7a52e5be40aefb51230397">   86</a></span>&#160;    <a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a>&amp; <a class="code" href="classvigra_1_1SamplerOptions.html#a71724571dc7a52e5be40aefb51230397" title="Sample from training population with replacement. ">withReplacement</a>(<span class="keywordtype">bool</span> in = <span class="keyword">true</span>)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        sample_with_replacement = in;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">        /**\brief Sample from training population without replacement.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">         * &lt;br&gt; Default (if you don&#39;t call this function): false</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="code" href="classvigra_1_1SamplerOptions.html#aeda2861af920abfb59a5db4fee568a8e">   96</a></span>&#160;    <a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a>&amp; <a class="code" href="classvigra_1_1SamplerOptions.html#aeda2861af920abfb59a5db4fee568a8e" title="Sample from training population without replacement. ">withoutReplacement</a>(<span class="keywordtype">bool</span> in = <span class="keyword">true</span>)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        sample_with_replacement = !in;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">        /**\brief Draw the given number of samples.</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">         * If stratifiedSampling is true, the \a size is equally distributed</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">         * across all strata (e.g. &lt;tt&gt;size / strataCount&lt;/tt&gt; samples are taken </span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">         * from each stratum, subject to rounding).</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">         * &lt;br&gt; Default: 0 (i.e. determine the count by means of sampleProportion())</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="code" href="classvigra_1_1SamplerOptions.html#a851a757874c19a2e2ac7d918216c973e">  109</a></span>&#160;    <a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a>&amp; <a class="code" href="classvigra_1_1SamplerOptions.html#a851a757874c19a2e2ac7d918216c973e" title="Draw the given number of samples. If stratifiedSampling is true, the size is equally distributed acro...">sampleSize</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size)</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        sample_size = size;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">        /**\brief Determine the number of samples to draw as a proportion of the total</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">         * number. That is, we draw &lt;tt&gt;count = totalCount * proportion&lt;/tt&gt; samples. </span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">         * This option is overridden when an absolute count is specified by sampleSize().</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">         * </span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">         * If stratifiedSampling is true, the count is equally distributed</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">         * across all strata (e.g. &lt;tt&gt;totalCount * proportion / strataCount&lt;/tt&gt; samples are taken </span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">         * from each stratum).</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">         * &lt;br&gt; Default: 1.0</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="code" href="classvigra_1_1SamplerOptions.html#a1c46734a912f60a8d28672c28e473580">  126</a></span>&#160;    <a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a>&amp; <a class="code" href="classvigra_1_1SamplerOptions.html#a1c46734a912f60a8d28672c28e473580" title="Determine the number of samples to draw as a proportion of the total number. That is...">sampleProportion</a>(<span class="keywordtype">double</span> proportion)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        vigra_precondition(proportion &gt;= 0.0,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;               <span class="stringliteral">&quot;SamplerOptions::sampleProportion(): argument must not be negative.&quot;</span>);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        sample_proportion = proportion;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">        /**\brief Draw equally many samples from each &quot;stratum&quot;. </span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">         *  A stratum is a group of like entities, e.g. pixels belonging </span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">         *  to the same object class. This is useful to create balanced samples  </span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">         *  when the class probabilities are very unbalanced (e.g.</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">         *  when there are many background and few foreground pixels).</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">         *  Stratified sampling thus avoids that a trained classifier is biased </span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">         *  towards the majority class. </span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">         * &lt;br&gt; Default (if you don&#39;t call this function): false</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="code" href="classvigra_1_1SamplerOptions.html#a849f4fbf15f9555862fd54dc2ffd178c">  144</a></span>&#160;    <a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a>&amp; <a class="code" href="classvigra_1_1SamplerOptions.html#a849f4fbf15f9555862fd54dc2ffd178c" title="Draw equally many samples from each &quot;stratum&quot;. A stratum is a group of like entities, e.g. pixels belonging to the same object class. This is useful to create balanced samples when the class probabilities are very unbalanced (e.g. when there are many background and few foreground pixels). Stratified sampling thus avoids that a trained classifier is biased towards the majority class. ">stratified</a>(<span class="keywordtype">bool</span> in = <span class="keyword">true</span>)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        stratified_sampling = in;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;};</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">/************************************************************/</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">/*                                                          */</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">/*                        Sampler                           */</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">/*                                                          */</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">/************************************************************/</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">/** \brief Create random samples from a sequence of indices.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">    Selecting data items at random is a basic task of machine learning,</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">    for example in boostrapping, RandomForest training, and cross validation.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">    This class implements various ways to select random samples via their indices. </span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">    Indices are assumed to be consecutive in</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">    the range &lt;tt&gt;0 &amp;lt;= index &amp;lt; total_sample_count&lt;/tt&gt;.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">    The class always contains a current sample which can be accessed by </span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">    the index operator or by the function sampledIndices(). The indices</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">    that are not in the current sample (out-of-bag indices) can be accessed</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">    via the function oobIndices().</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">    The sampling method (with/without replacement, stratified or not) and the</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">    number of samples to draw are determined by the option object </span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">    SamplerOptions.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">    &lt;b&gt;Usage:&lt;/b&gt;</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">    &lt;b&gt;\#include&lt;/b&gt; &lt;vigra/sampling.hxx&gt;&lt;br&gt;</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">    Namespace: vigra</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">    Create a Sampler with default options, i.e. sample as many indices as there </span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">    are data elements, with replacement. On average, the sample will contain </span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">    &lt;tt&gt;0.63*totalCount&lt;/tt&gt; distinct indices.</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">    \code</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">    int totalCount = 10000;   // total number of data elements</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">    int numberOfSamples = 20; // repeat experiment 20 times </span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">    Sampler&lt;&gt; sampler(totalCount);</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">    for(int k=0; k&lt;numberOfSamples; ++k)</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">        // process current sample</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">        for(int i=0; i&lt;sampler.sampleSize(); ++i)</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">            int currentIndex = sampler[i];</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">            processData(data[currentIndex]);</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">        // create next sample</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">        sampler.sample();</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">    \endcode</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">    Create a Sampler for stratified sampling, without replacement.</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">    \code</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">    // prepare the strata (i.e. specify which stratum each element belongs to)</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">    int stratumSize1 = 2000, stratumSize2 = 8000,</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">        totalCount = stratumSize1 + stratumSize2;</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">    ArrayVerctor&lt;int&gt; strata(totalCount);</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">    for(int i=0; i&lt;stratumSize1; ++i)</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">        strata[i] = 1;</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">    for(int i=stratumSize1; i&lt;stratumSize2; ++i)</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">        strata[i] = 2;</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">        </span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">    int sampleSize = 200; // i.e. sample 100 elements from each of the two strata</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">    int numberOfSamples = 20; // repeat experiment 20 times </span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">    Sampler&lt;&gt; stratifiedSampler(strata.begin(), strata.end(),</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">                     SamplerOptions().withoutReplacement().stratified().sampleSize(sampleSize));</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">    // create first sample</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">    sampler.sample();</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">    for(int k=0; k&lt;numberOfSamples; ++k)</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">        // process current sample</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">        for(int i=0; i&lt;sampler.sampleSize(); ++i)</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">            int currentIndex = sampler[i];</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">            processData(data[currentIndex]);</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">        // create next sample</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">        sampler.sample();</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">    \endcode</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> Random = MersenneTwister &gt;</div>
<div class="line"><a name="l00233"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html">  233</a></span>&#160;<span class="keyword">class </span><a class="code" href="classvigra_1_1Sampler.html" title="Create random samples from a sequence of indices. ">Sampler</a></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;{</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">        /** Internal type of the indices.</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">            Currently, 64-bit indices are not supported because this</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">            requires extension of the random number generator classes.</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00240"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#a40ba4794cdd5dd316be26e9ccaa2703c">  240</a></span>&#160;    <span class="keyword">typedef</span> <a class="code" href="group__FixedSizeInt.html#ga92f05c4b6944ec5926841e34f03a9060" title="32-bit signed int ">Int32</a>                               <a class="code" href="classvigra_1_1Sampler.html#a40ba4794cdd5dd316be26e9ccaa2703c">IndexType</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1ArrayVector.html">ArrayVector&lt;IndexType&gt;</a>              <a class="code" href="classvigra_1_1ArrayVector.html">IndexArrayType</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment"></span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">        /** Type of the array view object that is returned by </span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">            sampledIndices() and oobIndices().</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00247"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#a346dae786f30c2688fedc39918397460">  247</a></span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1ArrayVectorView.html">ArrayVectorView &lt;IndexType&gt;</a>         <a class="code" href="classvigra_1_1Sampler.html#a346dae786f30c2688fedc39918397460">IndexArrayViewType</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keyword">private</span>:</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keyword">typedef</span> std::map&lt;IndexType, IndexArrayType&gt; StrataIndicesType;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keyword">typedef</span> std::map&lt;IndexType, int&gt;            StrataSizesType;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1ArrayVector.html">ArrayVector&lt;bool&gt;</a>                   <a class="code" href="classvigra_1_1ArrayVector.html">IsUsedArrayType</a>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1ArrayVectorView.html">ArrayVectorView&lt;bool&gt;</a>               <a class="code" href="classvigra_1_1ArrayVectorView.html">IsUsedArrayViewType</a>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span>        oobInvalid = -1;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordtype">int</span>                     total_count_, sample_size_;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keyword">mutable</span> <span class="keywordtype">int</span>             current_oob_count_;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    StrataIndicesType       strata_indices_;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    StrataSizesType         strata_sample_size_;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="classvigra_1_1ArrayVector.html">IndexArrayType</a>          current_sample_;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keyword">mutable</span> <a class="code" href="classvigra_1_1ArrayVector.html">IndexArrayType</a>  current_oob_sample_;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="classvigra_1_1ArrayVector.html">IsUsedArrayType</a>         is_used_;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    Random                  default_random_;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    Random <span class="keyword">const</span> &amp;          random_;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a>          options_;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordtype">void</span> initStrataCount()</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="comment">// compute how many samples to take from each stratum</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="comment">// (may be unequal if sample_size_ is not a multiple of strataCount())</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keywordtype">int</span> strata_sample_size = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code" href="group__FixedPointOperations.html#ga14fe7b9ffa21e091c6ff4ede68717c30" title="rounding up. ">std::ceil</a>(<span class="keywordtype">double</span>(sample_size_) / <a class="code" href="classvigra_1_1Sampler.html#a0070a84e45c87f74fa537ca7b72e349e">strataCount</a>()));</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordtype">int</span> strata_total_count = strata_sample_size * <a class="code" href="classvigra_1_1Sampler.html#a0070a84e45c87f74fa537ca7b72e349e">strataCount</a>();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">for</span>(StrataIndicesType::iterator i = strata_indices_.begin(); </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;             i != strata_indices_.end(); ++i)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="keywordflow">if</span>(strata_total_count &gt; sample_size_)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                strata_sample_size_[i-&gt;first] = strata_sample_size - 1;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                --strata_total_count;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                strata_sample_size_[i-&gt;first] = strata_sample_size;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment"></span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">        /** Create a sampler for \a totalCount data objects.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">            </span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">            In each invocation of &lt;tt&gt;sample()&lt;/tt&gt; below, it will sample</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">            indices according to the options passed. If no options are given, </span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">            &lt;tt&gt;totalCount&lt;/tt&gt; indices will be drawn with replacement.</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00298"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#ae6b32c66f656c5282454714cd68ac1b2">  298</a></span>&#160;    <a class="code" href="classvigra_1_1Sampler.html#ae6b32c66f656c5282454714cd68ac1b2">Sampler</a>(<a class="code" href="group__FixedSizeInt.html#gad055e2244a667a1a5a5c1ee4397c07f9" title="32-bit unsigned int ">UInt32</a> <a class="code" href="classvigra_1_1Sampler.html#a111bc7cfb9998a225c4338e207fe25de">totalCount</a>, <a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a> <span class="keyword">const</span> &amp; opt = <a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a>(), </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            Random <span class="keyword">const</span> * rnd = 0)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    : total_count_(totalCount),</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      sample_size_(opt.sample_size == 0</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                   ? static_cast&lt;int&gt;((std::<a class="code" href="group__FixedPointOperations.html#ga14fe7b9ffa21e091c6ff4ede68717c30" title="rounding up. ">ceil</a>(total_count_ * opt.sample_proportion)))</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                   : opt.sample_size),</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      current_oob_count_(oobInvalid),</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      current_sample_(sample_size_),</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      current_oob_sample_(total_count_),</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      is_used_(total_count_),</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      default_random_(RandomSeed),</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      random_(rnd ? *rnd : default_random_),</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      options_(opt)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        vigra_precondition(opt.sample_with_replacement || sample_size_ &lt;= total_count_,</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          <span class="stringliteral">&quot;Sampler(): Cannot draw without replacement when data size is smaller than sample count.&quot;</span>);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;          </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        vigra_precondition(!opt.stratified_sampling,</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;          <span class="stringliteral">&quot;Sampler(): Stratified sampling requested, but no strata given.&quot;</span>);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;          </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="comment">// initialize a single stratum containing all data</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        strata_indices_[0].resize(total_count_);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;total_count_; ++i)</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            strata_indices_[0][i] = i;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        initStrataCount();</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="comment">//this is screwing up the random forest tests.</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="comment">//sample();</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment"></span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">        /** Create a sampler for stratified sampling.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">            </span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">            &lt;tt&gt;strataBegin&lt;/tt&gt; and &lt;tt&gt;strataEnd&lt;/tt&gt; must refer to a sequence </span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">            which specifies for each sample the stratum it belongs to. The</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">            total number of data objects will be set to &lt;tt&gt;strataEnd - strataBegin&lt;/tt&gt;.</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">            Equally many samples (subject to rounding) will be drawn from each stratum, </span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">            unless the option object explicitly requests unstratified sampling, </span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">            in which case the strata are ignored.</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">class</span> Iterator&gt;</div>
<div class="line"><a name="l00338"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#aaaa801f6b1da9bd5c708484466efb873">  338</a></span>&#160;    <a class="code" href="classvigra_1_1Sampler.html#aaaa801f6b1da9bd5c708484466efb873">Sampler</a>(Iterator strataBegin, Iterator strataEnd, <a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a> <span class="keyword">const</span> &amp; opt = <a class="code" href="classvigra_1_1SamplerOptions.html" title="Options object for the Sampler class. ">SamplerOptions</a>(), </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            Random <span class="keyword">const</span> * rnd = 0)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    : total_count_(strataEnd - strataBegin),</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      sample_size_(opt.sample_size == 0</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                   ? static_cast&lt;int&gt;((std::<a class="code" href="group__FixedPointOperations.html#ga14fe7b9ffa21e091c6ff4ede68717c30" title="rounding up. ">ceil</a>(total_count_ * opt.sample_proportion)))</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                   : opt.sample_size),</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      current_oob_count_(oobInvalid),</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      current_sample_(sample_size_),</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      current_oob_sample_(total_count_),</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      is_used_(total_count_),</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      default_random_(RandomSeed),</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      random_(rnd ? *rnd : default_random_),</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      options_(opt)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        vigra_precondition(opt.sample_with_replacement || sample_size_ &lt;= total_count_,</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;          <span class="stringliteral">&quot;Sampler(): Cannot draw without replacement when data size is smaller than sample count.&quot;</span>);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;          </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="comment">// copy the strata indices</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">if</span>(opt.stratified_sampling)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; strataBegin != strataEnd; ++i, ++strataBegin)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                strata_indices_[*strataBegin].push_back(i);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            strata_indices_[0].resize(total_count_);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;total_count_; ++i)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                strata_indices_[0][i] = i;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        vigra_precondition(sample_size_ &gt;= static_cast&lt;int&gt;(strata_indices_.size()),</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <span class="stringliteral">&quot;Sampler(): Requested sample count must be at least as large as the number of strata.&quot;</span>);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        initStrataCount();</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="comment">//this is screwing up the random forest tests.</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="comment">//sample();</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">        /** Return the k-th index in the current sample.</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00380"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#a6046319769ed4b411a27f8cfa0d76907">  380</a></span>&#160;    <a class="code" href="classvigra_1_1Sampler.html#a40ba4794cdd5dd316be26e9ccaa2703c">IndexType</a> <a class="code" href="classvigra_1_1Sampler.html#a6046319769ed4b411a27f8cfa0d76907">operator[]</a>(<span class="keywordtype">int</span> k)<span class="keyword"> const</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">return</span> current_sample_[k];</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">        /** Create a new sample.</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga50a2ce599e896bfb535e70a42003ed23">sample</a>();</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">        /** The total number of data elements.</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00391"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#a111bc7cfb9998a225c4338e207fe25de">  391</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classvigra_1_1Sampler.html#a111bc7cfb9998a225c4338e207fe25de">totalCount</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">return</span> total_count_;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">        /** The number of data elements that have been sampled.</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00398"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#a5662e24a3f111a63d910484acdb6453e">  398</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classvigra_1_1Sampler.html#a5662e24a3f111a63d910484acdb6453e">sampleSize</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keywordflow">return</span> sample_size_;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">        /** Same as sampleSize().</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00405"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#ab8e4e3e2a7bf18888b71bdf9dda0770b">  405</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classvigra_1_1Sampler.html#ab8e4e3e2a7bf18888b71bdf9dda0770b">size</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">return</span> sample_size_;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">        /** The number of strata to be used.</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">            Will be 1 if no strata are given. Will be ignored when</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">            stratifiedSampling() is false.</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00414"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#a0070a84e45c87f74fa537ca7b72e349e">  414</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classvigra_1_1Sampler.html#a0070a84e45c87f74fa537ca7b72e349e">strataCount</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">return</span> strata_indices_.size();</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">        /** Whether to use stratified sampling.</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">            (If this is false, strata will be ignored even if present.)</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00422"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#a9e6dd687db89ea4a5124d5776adae556">  422</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classvigra_1_1Sampler.html#a9e6dd687db89ea4a5124d5776adae556">stratifiedSampling</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">return</span> options_.stratified_sampling;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment"></span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">        /** Whether sampling should be performed with replacement.</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#aa02ea40ec99e200d9ce3489f735f0d3b">  429</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classvigra_1_1Sampler.html#aa02ea40ec99e200d9ce3489f735f0d3b">withReplacement</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keywordflow">return</span> options_.sample_with_replacement;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment"></span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">        /** Return an array view containing the indices in the current sample.</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00436"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#a4dd6492d26201473904728117859a544">  436</a></span>&#160;    <a class="code" href="classvigra_1_1ArrayVectorView.html">IndexArrayViewType</a> <a class="code" href="classvigra_1_1Sampler.html#a4dd6492d26201473904728117859a544">sampledIndices</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordflow">return</span> current_sample_;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment"></span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">        /** Return an array view containing the out-of-bag indices.</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">            (i.e. the indices that are not in the current sample)</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="code" href="classvigra_1_1Sampler.html#a75e82a037131304c9f3844a08b9fa616">  444</a></span>&#160;    <a class="code" href="classvigra_1_1ArrayVectorView.html">IndexArrayViewType</a> <a class="code" href="classvigra_1_1Sampler.html#a75e82a037131304c9f3844a08b9fa616">oobIndices</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">if</span>(current_oob_count_ == oobInvalid)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            current_oob_count_ = 0;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;total_count_; ++i)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                <span class="keywordflow">if</span>(!is_used_[i])</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                    current_oob_sample_[current_oob_count_] = i;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                    ++current_oob_count_;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">return</span> current_oob_sample_.<a class="code" href="classvigra_1_1ArrayVectorView.html#aed17bfb11fdbac09a00c0c217047e30d">subarray</a>(0, current_oob_count_);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    IsUsedArrayType <span class="keyword">const</span> &amp; is_used()<span class="keyword"> const</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">return</span> is_used_;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;};</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> Random&gt;</div>
<div class="line"><a name="l00468"></a><span class="lineno"><a class="code" href="group__MachineLearning.html#ga50a2ce599e896bfb535e70a42003ed23">  468</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__MachineLearning.html#ga50a2ce599e896bfb535e70a42003ed23">Sampler&lt;Random&gt;::sample</a>()</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;{</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    current_oob_count_ = oobInvalid;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    is_used_.init(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">if</span>(options_.sample_with_replacement)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment">//Go thru all strata</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordtype">int</span> j = 0;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        StrataIndicesType::iterator iter;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">for</span>(iter = strata_indices_.begin(); iter != strata_indices_.end(); ++iter)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            <span class="comment">// do sampling with replacement in each strata and copy data.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            <span class="keywordtype">int</span> stratum_size = iter-&gt;second.size();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; static_cast&lt;int&gt;(strata_sample_size_[iter-&gt;first]); ++i, ++j)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                current_sample_[j] = iter-&gt;second[random_.uniformInt(stratum_size)];</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                is_used_[current_sample_[j]] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="comment">//Go thru all strata</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordtype">int</span> j = 0;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        StrataIndicesType::iterator iter;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keywordflow">for</span>(iter = strata_indices_.begin(); iter != strata_indices_.end(); ++iter)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            <span class="comment">// do sampling without replacement in each strata and copy data.</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordtype">int</span> stratum_size = iter-&gt;second.size();</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; static_cast&lt;int&gt;(strata_sample_size_[iter-&gt;first]); ++i, ++j)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                std::swap(iter-&gt;second[i], iter-&gt;second[i+ random_.uniformInt(stratum_size - i)]);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                current_sample_[j] = iter-&gt;second[i];</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                is_used_[current_sample_[j]] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            }</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;}</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> Random =RandomTT800 &gt;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="keyword">class </span>PoissonSampler</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;{</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    Random  randfloat;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="group__FixedSizeInt.html#ga92f05c4b6944ec5926841e34f03a9060" title="32-bit signed int ">Int32</a>                               IndexType;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classvigra_1_1ArrayVector.html">vigra::ArrayVector     &lt;IndexType&gt;</a>  IndexArrayType;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    IndexArrayType        used_indices_;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordtype">double</span> lambda;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordtype">int</span> minIndex;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordtype">int</span> maxIndex;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    PoissonSampler(<span class="keywordtype">double</span> lambda,IndexType minIndex,IndexType maxIndex)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    : lambda(lambda),</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      minIndex(minIndex),</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      maxIndex(maxIndex)</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    {}</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordtype">void</span> sample(  )</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        used_indices_.clear();</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        IndexType i;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="keywordflow">for</span>(i=minIndex;i&lt;maxIndex;++i)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            <span class="comment">//from http://en.wikipedia.org/wiki/Poisson_distribution</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <span class="keywordtype">int</span> k=0;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="keywordtype">double</span> p=1;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="keywordtype">double</span> L=<a class="code" href="group__LinearAlgebraFunctions.html#ga2a9e01ae7ae7b39a618e9f4a6afaee5b">exp</a>(-lambda);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <span class="keywordflow">do</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                ++k;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                p*=randfloat.uniform53();</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            }<span class="keywordflow">while</span>(p&gt;L);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            --k;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="comment">//Insert i this many time</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            <span class="keywordflow">while</span>(k&gt;0)</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                used_indices_.push_back(i);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                --k;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    IndexType <span class="keyword">const</span> &amp; operator[](<span class="keywordtype">int</span> in)<span class="keyword"> const</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keywordflow">return</span> used_indices_[in];</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordtype">int</span> numOfSamples()<span class="keyword"> const</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordflow">return</span> used_indices_.size();</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;};</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">//@}</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;} <span class="comment">// namespace vigra</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/*VIGRA_SAMPLING_HXX*/</span><span class="preprocessor"></span></div>
</div><!-- fragment --></div><!-- contents -->
<!-- footer.html -->
<p>
<table border=0 cellspacing=0 width="100%"  bgcolor="#e0d0a0" cellpadding=5>
<tr>
<td>
<p>
<i>&copy; <A HREF="http://hci.iwr.uni-heidelberg.de/people/ukoethe/">Ullrich K&ouml;the</A>     (<A
HREF="mailto:ullrich.koethe@iwr.uni-heidelberg.de">ullrich.koethe@iwr.uni-heidelberg.de</A>)</i> <br>
<i><A HREF="http://hci.iwr.uni-heidelberg.de/">
Heidelberg Collaboratory for Image Processing</a>,
University of Heidelberg, Germany</i>
<td>
<p align=right>
<I>html generated using <A HREF="http://www.doxygen.org">doxygen</A> and <A HREF="http://www.python.org">Python</A></I>
<br>
<i>
vigra 1.10.0 (Thu Jan 8 2015)
</i>
</tr>
</table>
</BODY>
</HTML>
