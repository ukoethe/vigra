platform:
    - x64

environment:
    matrix:
        - PYTHON_VERSION: "2.7"
          CONDA_PY: "27"
        - PYTHON_VERSION: "3.5"
          CONDA_PY: "35"

build_script:
    - if "%CONDA_PY:~0,1%" == "2" set PATH=C:\\Miniconda-x64\\Scripts;%PATH%
    - if "%CONDA_PY:~0,1%" == "3" set PATH=C:\\Miniconda3-x64\\Scripts;%PATH%
    - set PATH=C:\\Miniconda%CONDA_PY:~0,1%-x64\\Scripts;%PATH%
    - conda create -q --yes -n python python=%PYTHON_VERSION% jpeg libpng libtiff hdf5 numpy nose
    - activate python
    - if "%CONDA_PY:~0,1%" == "2" conda install -q --yes -c ukoethe --override-channels visual-studio=11.0 python=2.7 jpeg libpng libtiff hdf5 numpy nose boost fftw
    - if "%CONDA_PY:~0,1%" == "3" conda install -q --yes -c ukoethe --override-channels visual-studio=14.0 fftw boost
    - cd %APPVEYOR_BUILD_FOLDER%
    - mkdir build
    - cd build
    - if "%CONDA_PY:~0,1%" == "2" cmake .. -G "Visual Studio 11 Win64" -DVIGRANUMPY_REQUIRED=1 -DDEPENDENCY_SEARCH_PREFIX="%CONDA_ACTIVE_ENV%/Library"
    - if "%CONDA_PY:~0,1%" == "3" cmake .. -G "Visual Studio 14 Win64" -DVIGRANUMPY_REQUIRED=1 -DDEPENDENCY_SEARCH_PREFIX="%CONDA_ACTIVE_ENV%/Library"
    - cmake --build . --target check --config Release
