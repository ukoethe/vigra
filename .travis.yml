matrix:
  include:
    - os: linux
      sudo: false
      language: python
      python: "2.7"
    - os: linux
      sudo: false
      language: python
      python: "3.2"
    - os: osx
      language: generic
      env: TRAVIS_PYTHON_VERSION="2.7"
    - os: osx
      language: generic
      env: TRAVIS_PYTHON_VERSION="3.2"


addons:
  apt:
    packages:
      - libhdf5-serial-dev
      - libboost-python-dev
      - libjpeg-dev
      - libtiff4-dev
      - libpng12-dev
      - libfftw3-dev
      - libatlas-base-dev
      - cmake

before_script:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install pyenv || true                       ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pyenv install ${TRAVIS_PYTHON_VERSION}           ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pyenv rehash                                     ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pyenv global ${TRAVIS_PYTHON_VERSION}            ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install hdf5 || true                        ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install boost --with-python                 ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install libjpeg || true                     ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install libtiff || true                     ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install libpng  || true                     ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install fftw || true                        ; fi
  - pip install nose
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pyenv rehash                                     ; fi
  - pip install numpy
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pyenv rehash                                     ; fi

script:
  - mkdir build && cd build
  - cmake -DCMAKE_BUILD_TYPE=Release -DDEPENDENCY_SEARCH_PREFIX=$VIRTUAL_ENV -DAUTOBUILD_TESTS=1 -DAUTOEXEC_TESTS=0 -DPYTHON_VERSION=${TRAVIS_PYTHON_VERSION:0:3} ..
  - make
  - ctest --output-on-failure
